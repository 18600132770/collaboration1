<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huag.collaboration.mapper.UserProjectMapper">

    <select id="findUserProjectByProjectNameAndDeptId" resultType="com.huag.collaboration.entities.mapping.UserProjectMapping">
        SELECT
          a.id id, b.username username, b.tripState tripState, e.projectName, e.designPhase, a.taskLevel, c.startTime, c.stopTime, c.currentProcess, a.role
        from
          userProjectMapping a, user b, project c, projectSummary e
        where
              (a.deltag <![CDATA[ <> ]]> '1' or a.deltag is null)
          and (b.deltag <![CDATA[ <> ]]> '1' or b.deltag is null)
          and (c.deltag <![CDATA[ <> ]]> '1' or c.deltag is null)
          and a.userId = b.id
          and a.projectId = c.id
          and c.projectSummaryId = e.id
          and b.username like "%"#{searchKey}"%"
          and c.departmentId = #{departmentId}
        order by b.username asc
    </select>


</mapper>