<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>中国知网大数据融合应用平台</title>

		<link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet">
		<link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
		<link href="asserts/element2.10.1/index.css" th:href="@{/asserts/element2.10.1/index.css}" rel="stylesheet">
		<link href="asserts/css/myCSS.css" th:href="@{/asserts/css/myCSS.css}" rel="stylesheet">
		<link href="asserts/css/myManager.css" th:href="@{/asserts/css/myManager.css}" rel="stylesheet">
		<link href="asserts/css/myCutWord.css" th:href="@{/asserts/css/myCutWord.css}" rel="stylesheet">
	</head>

	<body>
		<div id="app">

			<div id="appheader">
				<div class="top">
					<a  th:href="@{/redirectToMain}">
						<h1  style="color: #ffffff; margin-left: 10px; margin-top: 20px" class="top-t" >中国知网大数据融合应用平台</h1>
					</a>
				</div>
			</div>


			<div >
				<div class="dsource-wrap" style="margin-top: 5px">
					<!-- 左侧  -->
					<el-scrollbar class="dictionary-l">
						<ul class="manager-nav dictionary-nav">
							<li class="m-a">
								<svg class="icon" aria-hidden="true">
									<use xlink:href="#icon-hh2"></use>
								</svg>
								<ul class="manager-sec">
									<li><a class="m-a cur" th:href="@{/projects}">项目信息</a></li>
									<li><a th:href="@{/userProjects}">人员项目信息</a></li>
								</ul>
							</li>
						</ul>
					</el-scrollbar>


					<el-scrollbar class="dsource-r">

						<div class="ds-table-wrap" >

							<nav style="margin-left: 1300px" class="navbar navbar-light bg-light">
								<!--<h2><a class="btn btn-sm alert-info" href="project" :href="'/crud/project/'">添加项目</a></h2>-->
								<div class="select-group">
									<el-input class="select-zu" placeholder="输入查询内容" v-model="searchKey"></el-input>
									<el-button class="select-btn" @click="searchClick" >查找</el-button>
								</div>
							</nav>

							<!--<ul class="manager-sec" v-for="project, key in projects" :key="key">-->
								<!--<li @click="showProjectById(project.id)"><a :class="project.deltag" >{{project.projectName}}</a></li>-->
							<!--</ul>-->

							<!--nav-item nav-link active-->

							<nav>
								<div class="nav nav-tabs" role="tablist" v-for="department, key in departments" :key="key">
									<a style="display: inline-block" :class="department.style" @click="getProjectByDepartment(department.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{department.departmentName}}</a>
								</div>
							</nav>

							<el-table style="width: 100%;margin-top: 10px;" :data="tableData" class="x-table table-td0">
								<el-table-column type="selection" width="55"></el-table-column>
								<!--<el-table-column label="序号" width="60" type="index">-->
								<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
								<!--</el-table-column>-->
								<el-table-column label="项目名称">
									<template slot-scope="scope"><a  target="_blank">{{ scope.row.projectName }} </a></template>
								</el-table-column>
								<el-table-column label="设计阶段">
									<template slot-scope="scope"><span>{{ scope.row.designPhase }}</span></template>
								</el-table-column>
								<el-table-column label="负责人">
                                    <!--TODO  点击从数据库中选择-->
									<template slot-scope="scope"><span @click="editProjectPrincipalClick(scope.row.id)"></span></template>
								</el-table-column>
                                <el-table-column label="总工">
                                    <!--TODO  点击从数据库中选择-->
                                    <template slot-scope="scope"><span @click="editProjectChiefEngineerClick(scope.row.id)"></span></template>
                                </el-table-column>
                                <el-table-column label="开始时间">
									<template slot-scope="scope"><span>{{ scope.row.startTime }}</span></template>
								</el-table-column>
								<el-table-column  label="截止时间">
									<template slot-scope="scope"><span>{{ scope.row.stopTime }}</span></template>
								</el-table-column>
								<el-table-column  label="剩余天数">
									<template slot-scope="scope"><span>{{ scope.row.leftTime }}</span></template>
								</el-table-column>
								<el-table-column  label="目前进度">
									<template slot-scope="scope">
										<span>
											<div class="progress">
											  <div class="progress-bar" role="progressbar" :style="'width: '+ scope.row.currentProcess + '%;'" aria-valuenow="scope.row.currentProcess" aria-valuemin="0" aria-valuemax="100">{{ scope.row.currentProcess }}%</div>
											</div>
										</span></template>
								</el-table-column>
								<el-table-column  label="紧急程度">
									<template slot-scope="scope"><span>{{ scope.row.emergencyLevel }}</span></template>
								</el-table-column>
								<!--<el-table-column label="操作" min-width="100">-->
									<!--<template slot-scope="scope">-->
										<!--<el-button class="btn-line btn-0 cur" size="mini"><a :href="'/crud/project/'+scope.row.id">编辑</a></el-button>-->
										<!--<el-button class="btn-line btn-0" size="mini" @click="deleteProjectClick(scope.row.id)">删除</el-button>-->
									<!--</template>-->
								<!--</el-table-column>-->
							</el-table>
							<el-pagination class="txtCenter"
										   @size-change="handleSizeChange"
										   @current-change="handleCurrentChange"
										   :current-page.sync="currentPage"
										   :page-sizes="[10,20,30,50]"
										   :page-size="100"
										   layout=" sizes, prev, pager, next"
										   :total="1000">
							</el-pagination>
						</div>
					</el-scrollbar>
				</div>
			</div>


			<!-- 编辑负责人Modal -->
			<el-dialog title="编辑负责人" :visible.sync="dialogEditPrincipalVisible" width="30%">
				<div class="form-group" hidden="true">
					<label>id</label>
					<input type="text" class="form-control" placeholder=""  v-model="principalIdModalInput">
				</div>
				<div class="form-group">
					<label>负责人</label>
					<input type="text" class="form-control" placeholder=""  v-model="principalNameModalInput">
				</div>
				<div class="modal-footer">
					<button  class="btn btn-primary" @click="savePrincipal">保存</button>
				</div>
			</el-dialog>

			<script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js" th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script>
			<script type="text/javascript" src="asserts/js/popper.min.js" th:src="@{/webjars/popper.js/1.11.1/dist/popper.js}"></script>
			<script type="text/javascript" src="asserts/js/bootstrap.min.js" th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>

			<script type="text/javascript" src="asserts/js/feather.min.js" th:src="@{/asserts/js/feather.min.js}"></script>
			<script type="text/javascript" src="asserts/js/vue.js" th:src="@{/asserts/js/vue.js}"></script>
			<script type="text/javascript" src="asserts/js/iconfont.js" th:src="@{/asserts/js/iconfont.js}"></script>
			<script type="text/javascript" src="asserts/element2.10.1/index.js" th:src="@{/asserts/element2.10.1/index.js}"></script>


			<script>
				feather.replace()
			</script>

			<script type="text/javascript">

				window.searchKeyWord = ""

				var app = new Vue({
					el: '#app',
					data: {
							dialogFormVisible: false,
							currentPage: 1,
							tableData: null,
							searchKey: null,
							myValue: 1,
							departments:{

							},
							principalIdModalInput: null,
							principalNameModalInput: null,
							dialogEditPrincipalVisible: false,
						},
					methods: {
						handleSizeChange(val) {
							console.log(`每页 ${val} 条`);
						},
						handleCurrentChange(val) {
							console.log(`当前页: ${val}`);
						},
						searchClick :function () {
							findProjectBySearchKeyWord()
						},
						getProjectByDepartment: function(departmentId){
							var departments = app.departments
							for(var i = 0; i < departments.length; i++){
								if(i == (departmentId-1)){
									departments[i].style = 'nav-item nav-link active'
								}else{
									departments[i].style = 'nav-item nav-link'
								}
							}
							app.departments = departments
							findProjectByDepartmentId(departmentId) //根据所名称查询项目
						},
						deleteProjectClick: function (projectId) {
							var ajaxData = {}
							ajaxData.id = projectId
							$.ajax({
								data: ajaxData,
								type: "GET",
								url: "project/delete",
								success: function (result) {
									if(result.code == 200){
										findProjectBySearchKeyWord()
									}else{
										console.log("返回值失败")
									}

								}
							})
						},
						savePrincipal: function(){	//保存负责人modal

						},
						editProjectPrincipalClick: function (id) {//点击编辑负责人
							app.dialogEditPrincipalVisible = true
							//TODO
						},
						editProjectChiefEngineerClick: function () {//点击编辑总工

						}
					}

				})

				getDepartments();//查询所有所信息

				var ajaxData = {}
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "project/findAll",
					success: function (result) {
						if(result.code == 200){
							app.$data.tableData=result.data
						}else{
							console.log("返回值失败")
						}

					}
				})

				function findProjectBySearchKeyWord(){
					var ajaxData = {}
					if(app.searchKey != null){
						ajaxData.projectName = encodeURI(app.searchKey);
					}else{
						ajaxData.projectName = encodeURI("");
					}
					var type = "GET"
					var url = "project/findByProjectName"
					sendAjax(ajaxData, type, url)
				}

				function sendAjax(ajaxData, type, url) {
					$.ajax({
						data: ajaxData,
						type: type,
						url: url,
						success: function (result) {
							if(result.code == 200){
								app.$data.tableData=result.data
							}else{
								console.log("返回值失败")
							}

						}
					})
				}

				/**
				 * 根据所id查询项目
				 */
				function findProjectByDepartmentId(departmentId) {
					var ajaxData = {}
					ajaxData.departmentId = departmentId
					$.ajax({
						data: ajaxData,
						type: "GET",
						url: "/crud/project/findProjectByDepartmentId",
						success: function (result) {
							if(result.code == 200){
								app.$data.tableData=result.data
							}else{
								console.log("返回值失败")
							}

						}
					})
				}


				/**
				 * 查询所有所信息，将值赋给li
				 */
				function getDepartments() {
					$.ajax({
						data: null,
						type: "GET",
						url: "/crud/department/findAll",
						success: function (result) {
							if(result.code == 200){
								var departments = result.data
								for(var i = 0; i < departments.length; i++){
									if(i == 0){
										departments[i].style = 'nav-item nav-link active'
										findProjectByDepartmentId(departments[i].id)//根据所id查询项目
									}else{
										departments[i].style = 'nav-item nav-link'
									}
								}
								app.departments = departments
							}else{
								console.log("getDepartments 返回值失败")
							}

						}
					})
				}



			</script>
		</div>
	</body>
</html>