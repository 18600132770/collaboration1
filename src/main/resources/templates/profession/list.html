<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml"
	  xmlns:v-bind="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>中国知网大数据融合应用平台</title>

		<link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet">
		<link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
		<link href="asserts/element2.10.1/index.css" th:href="@{/asserts/element2.10.1/index.css}" rel="stylesheet">
		<link href="asserts/css/myCSS.css" th:href="@{/asserts/css/myCSS.css}" rel="stylesheet">
		<link href="asserts/css/myManager.css" th:href="@{/asserts/css/myManager.css}" rel="stylesheet">
		<link href="asserts/css/myCutWord.css" th:href="@{/asserts/css/myCutWord.css}" rel="stylesheet">
	</head>

	<body>
		<div id="flw">

			<div id="appheader">
				<div class="top">
					<a  th:href="@{/redirectToMain}">
						<h1  style="color: #ffffff; margin-left: 10px; margin-top: 20px" class="top-t" >中国知网大数据融合应用平台</h1>
					</a>
				</div>
			</div>



			<div id="app">
				<div class="dsource-wrap" style="margin-top: 5px">
					<!-- 左侧  -->
					<el-scrollbar class="dictionary-l">

                        <div style="height: 50px; margin-left: 10px">
                            <button type="button" class="btn btn-primary" @click="addProjectClick">新增项目</button>
                        </div>

						<ul class="manager-nav dictionary-nav">
							<li class="m-a">
								<svg class="icon" aria-hidden="true">
									<use xlink:href="#icon-hh2"></use>
								</svg>

								<ul class="manager-sec" v-for="project, key in projects" :key="key">
									<li @click="showProjectById(project.id)"><a :class="project.deltag" >{{project.projectName}}</a></li>
								</ul>
							</li>
						</ul>
					</el-scrollbar>

					<el-scrollbar class="dsource-r">
						<nav class="navbar navbar-light bg-light">

							<label style="display: inline">项目编号：{{project.projectNum}}</label>
							<label style="margin-left: 50px; display: inline">项目名称：{{project.projectName}}</label>
							<label style="margin-left: 50px; display: inline">项目阶段：{{project.designPhase}}</label>
							<label style="margin-left: 50px; display: inline">开始时间：2019-01-01
							</label>
							<label style="margin-left: 50px; display: inline">截止时间：2019-10-01</label>

						</nav>
						<div class="ds-table-wrap" >
							<el-table style="width: 100%;" :data="tableData" class="x-table table-td0">
								<el-table-column type="selection" width="55"></el-table-column>
								<!--<el-table-column label="序号" width="60" type="index">-->
								<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
								<!--</el-table-column>-->
								<el-table-column label="专业">
									<template slot-scope="scope"><a target="_blank" th:href="@{/profession/1}">{{ scope.row.profession }} </a></template>
								</el-table-column>
								<!--<el-table-column label="专业审定">-->
								<el-table-column label="专业负责人">
									<template slot-scope="scope"><span>{{ scope.row.professionValidation }}</span></template>
								</el-table-column>
								<!--<el-table-column label="处审定">-->
								<el-table-column label="总工">
									<template slot-scope="scope"><span>{{ scope.row.departmentalValidation }}</span></template>
								</el-table-column>
								<el-table-column  label="备注">
									<template slot-scope="scope"><span>{{ scope.row.remark }}</span></template>
								</el-table-column>
							</el-table>
							<el-pagination class="txtCenter"
										   @size-change="handleSizeChange"
										   @current-change="handleCurrentChange"
										   :current-page.sync="currentPage"
										   :page-sizes="[10,20,30,50]"
										   :page-size="100"
										   layout=" sizes, prev, pager, next"
										   :total="1000">
							</el-pagination>
						</div>
					</el-scrollbar>


					<!-- 添加项目Modal -->
					<el-dialog title="添加项目" :visible.sync="dialogAddProjectVisible" width="30%">
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">项目编号：</label>
							<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="addProject.projectNum">
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">项目名称：</label>
							<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="addProject.projectName">
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">设计阶段：</label>
							<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="addProject.designPhase">
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">开始时间：</label>
							<el-date-picker	v-model="addProject.startTime" type="date" placeholder="选择日期"></el-date-picker>
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">结束时间：</label>
							<el-date-picker	v-model="addProject.stopTime" type="date" placeholder="选择日期"></el-date-picker>
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">负责人：</label>
							<input type="text" class="form-control" style="width: 80%; display: inline" placeholder="" v-model="addProject.principal">
						</div>
						<div class="form-group">
							<label style="margin-left: 10px; display: inline; width: 20%;">总工：</label>
							<input type="text" class="form-control" style="width: 80%; display: inline" placeholder="" v-model="addProject.chiefEngineer">
						</div>
						<!--TODO 添加多选框-->
						<div class="modal-footer">
							<button  class="btn btn-primary" @click="saveAddProject">保存</button>
						</div>
					</el-dialog>


				</div>
			</div>

			<script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js" th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script>
			<script type="text/javascript" src="asserts/js/popper.min.js" th:src="@{/webjars/popper.js/1.11.1/dist/popper.js}"></script>
			<script type="text/javascript" src="asserts/js/bootstrap.min.js" th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>

			<script type="text/javascript" src="asserts/js/feather.min.js" th:src="@{/asserts/js/feather.min.js}"></script>
			<script type="text/javascript" src="asserts/js/vue.js" th:src="@{/asserts/js/vue.js}"></script>
			<script type="text/javascript" src="asserts/js/iconfont.js" th:src="@{/asserts/js/iconfont.js}"></script>
			<script type="text/javascript" src="asserts/element2.10.1/index.js" th:src="@{/asserts/element2.10.1/index.js}"></script>


			<script>
				feather.replace()
			</script>

			<script type="text/javascript">

				var app = new Vue({
					el: '#app',
					data: {
						dialogFormVisible: false,
						currentPage: 1,
						tableData: null,
						searchKey: null,
						project: {
							projectNum: "XM-20190101A",
							projectName: "马东铁路",
							designPhase: "设计",
						},
						projects:{

						},
						addProject:{},
						isActive: true,
						projectClass1: "m-a cur",
						dialogAddProjectVisible: false,
					},
					methods: {
						handleSizeChange(val) {
							console.log(`每页 ${val} 条`);
						},
						handleCurrentChange(val) {
							console.log(`当前页: ${val}`);
						},
						addProjectClick: function(){
							app.dialogAddProjectVisible = true
						},
						saveAddProject: function(){
							// TODO 保存项目，li 项目那边好像应该group by 去重后显示结果
							console.log(app.addProject)
						},
						showProjectById: function(id){
							// console.log("应该显示 " + id)
							var ajaxData = {}
							ajaxData.projectId = id
							$.ajax({
								data: ajaxData,
								type: "GET",
								url: "profession/findByProjectId/",
								success: function (result) {
									if(result.code == 200){
										app.$data.tableData=result.data
									}else{
										console.log("返回值失败")
									}

								}
							})

							//更改li颜色
							var myProjects = app.projects
							for(var i = 0; i < myProjects.length; i++){
								if(i == (id-1)){
									myProjects[i].deltag = 'm-a cur'
								}else{
									myProjects[i].deltag = ''
								}
							}
							app.projects = myProjects

							//查询项目信息，更新表头
							$.ajax({
								data: ajaxData,
								type: "GET",
								url: "project/findByProjectId/",
								success: function (result) {
									if(result.code == 200){
										app.$data.project=result.data
									}else{
										console.log("返回值失败 project/projectId")
									}

								}
							})


						},
					}

				})

				var ajaxData = {}
				ajaxData.projectId = 1
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "profession/findByProjectId/",
					success: function (result) {
						if(result.code == 200){
							app.$data.tableData=result.data
						}else{
							console.log("返回值失败 findByProjectId")
						}

					}
				})


				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "project/findByProjectId/",
					success: function (result) {
						if(result.code == 200){
							app.$data.project=result.data
						}else{
							console.log("返回值失败 project/projectId")
						}

					}
				})

				function sendAjax(ajaxData, type, url) {
					$.ajax({
						data: ajaxData,
						type: type,
						url: url,
						success: function (result) {
							if(result.code == 200){
								app.$data.tableData=result.data
							}else{
								console.log("返回值失败 sendAjax")
							}

						}
					})
				}

				/**
				 * 查找所有项目，将项目名字赋值给li，然后将class赋予一个变量
				 */
				var ajaxData = {}
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "project/findAll",
					success: function (result) {
						if(result.code == 200){
							var projectsLiShow = result.data
							for(var i = 0; i < projectsLiShow.length; i++){
								if(i == 0){
									projectsLiShow[i].deltag = 'm-a cur'
								}else{
									projectsLiShow[i].deltag = ''
								}
							}
							app.projects=projectsLiShow

						}else{
							console.log("返回值失败")
						}

					}
				})



			</script>
		</div>
	</body>
</html>