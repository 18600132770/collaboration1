<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml"
	  xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>中国知网大数据融合应用平台</title>

	<!--<link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">-->
	<!--<link href="asserts/element2.10.1/index.css" th:href="@{/asserts/element2.10.1/index.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/myCSS.css" th:href="@{/asserts/css/myCSS.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/myManager.css" th:href="@{/asserts/css/myManager.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/myCutWord.css" th:href="@{/asserts/css/myCutWord.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/axure_rp_page.css" th:href="@{/asserts/css/axure_rp_page.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/default.css" th:href="@{/asserts/css/default.css}" rel="stylesheet">-->
	<!--<link href="asserts/css/reset.css" th:href="@{/asserts/css/reset.css}" rel="stylesheet">-->

	<link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet">
	<link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
	<link href="asserts/element2.10.1/index.css" th:href="@{/asserts/element2.10.1/index.css}" rel="stylesheet">
	<link href="asserts/css/myCSS.css" th:href="@{/asserts/css/myCSS.css}" rel="stylesheet">
	<link href="asserts/css/myManager.css" th:href="@{/asserts/css/myManager.css}" rel="stylesheet">
	<link href="asserts/css/myCutWord.css" th:href="@{/asserts/css/myCutWord.css}" rel="stylesheet">
</head>

<body>
<div id="flw">

	<div id="appheader">
		<div class="top">
			<a  th:href="@{/redirectToMain}">
				<h1  style="color: #ffffff; margin-left: 10px; margin-top: 20px" class="top-t" >中国知网大数据融合应用平台</h1>
			</a>
		</div>
	</div>



	<div id="app">
		<div class="dsource-wrap" style="margin-top: 5px">
			<!-- 左侧  -->
			<el-scrollbar class="dictionary-l">
				<ul class="manager-nav dictionary-nav">
					<li class="m-a">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-hh2"></use>
						</svg>
						<ul class="manager-sec" v-for="project, key in projects" :key="key">
							<li @click="showProjectById(project.id)"><a :class="project.deltag" >{{project.departmentName}}</a></li>
						</ul>
					</li>
				</ul>
			</el-scrollbar>

			<el-scrollbar class="dsource-r">

				<nav class="navbar navbar-light bg-light">

					<el-input hidden="true"  v-model="projectSummaryId" style="height: 0px" ></el-input>
					<el-input hidden="true"  v-model="departmentId" style="height: 0px" ></el-input>
					<el-input hidden="true"  v-model="projectId"  style="height: 0px"></el-input>
					<el-input hidden="true"  v-model="selectUserRole"  style="height: 0px"></el-input>
					<el-input hidden="true"  v-model="selectTaskId"  style="height: 0px"></el-input>
					<el-input hidden="true"  v-model="previousProfileTabId"  style="height: 0px"></el-input>
					<el-input hidden="true"  v-model="nextProfessionProfileTabId"  style="height: 0px"></el-input>

					<el-button type="primary" @click="addTaskAssignmentClick">添加任务</el-button>

					<el-button type="primary" @click="showPreviousProfileDialog">上序资料</el-button>
					<el-button type="primary" @click="showNextProfessionProfileDialog">提下序</el-button>
					<el-button type="primary" @click="openProfileTreeDialog">专业项目文件</el-button>
					<el-button type="primary"><a  href="project" th:href="@{/notices}">通知</a></el-button>

				</nav>
				<div class="ds-table-wrap" >

					<!--<img  th:src="@{/asserts/img/1.PNG}">-->
					<nav>
						<div class="nav nav-tabs" role="tablist" v-for="navigationBar, key in navigationBars" :key="key">
							<a style="display: inline-block" :class="navigationBar.style" @click="switchNavigationBar(navigationBar.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{navigationBar.name}}</a>
						</div>
					</nav>

					<div :hidden="detailTableHidden" style="margin-top: 10px">
						<el-table style="width: 100%;" :data="taskAssignmentListData" class="x-table table-td0">
							<el-table-column type="selection" width="55"></el-table-column>
							<!--<el-table-column label="序号" width="60" type="index">-->
							<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
							<!--</el-table-column>-->
							<el-table-column label="任务">
								<template slot-scope="scope"><span>{{ scope.row.taskName }}</span></template>
							</el-table-column>
							<el-table-column label="任务级别">
								<template slot-scope="scope"><span>{{ scope.row.taskLevel }}</span></template>
							</el-table-column>
							<el-table-column label="设计">
								<template slot-scope="scope">
									<div @click="editDesignerClick(scope.row.id)">
											<span  style="color: #080fe8">
											 <el-link type="primary">{{ scope.row.designer }}</el-link>
										</span>
									</div>
								</template>
							</el-table-column>
							<el-table-column  label="复核">
								<template slot-scope="scope">
									<div @click="editReviewerClick(scope.row.id)">
											<span  style="color: #080fe8">
											 <el-link type="primary">{{ scope.row.reviewer }}</el-link>
										</span>
									</div>
								</template>
							</el-table-column>
							<el-table-column  label="审核">
								<template slot-scope="scope">
									<div @click="editInspectorClick(scope.row.id)">
											<span  style="color: #080fe8">
											 <el-link type="primary">{{ scope.row.inspector }}</el-link>
										</span>
									</div>
								</template>
							</el-table-column>
							<el-table-column  label="审定">
								<template slot-scope="scope">
									<div @click="editValidationerClick(scope.row.id)">
											<span  style="color: #080fe8">
											 <el-link type="primary">{{ scope.row.validationer }}</el-link>
										</span>
									</div>
								</template>
							</el-table-column>
							<el-table-column  label="开始时间">
								<template slot-scope="scope"><span>{{ scope.row.startTime }}</span></template>
							</el-table-column>
							<el-table-column  label="截止时间">
								<template slot-scope="scope"><span>{{ scope.row.stopTime }}</span></template>
							</el-table-column>
						</el-table>
						<el-pagination class="txtCenter"
									   @size-change="handleSizeChange"
									   @current-change="handleCurrentChange"
									   :current-page.sync="currentPage"
									   :page-sizes="[10,20,30,50]"
									   :page-size="100"
									   layout=" sizes, prev, pager, next"
									   :total="1000">
						</el-pagination>
					</div>

					<div :hidden="flowChartTableHidden" style="margin-top: 20px">
						<ul>
							<li v-for="taskAssignmentData, index in taskAssignmentListData" :key="index">
								<el-steps :active="taskAssignmentData.finishedLevel" align-center>
									<el-step :title="taskAssignmentData.designer" description="设计"></el-step>
									<el-step :title="taskAssignmentData.reviewer" description="复核"></el-step>
									<el-step :title="taskAssignmentData.inspector" description="审核"></el-step>
									<el-step :title="taskAssignmentData.validationer" description="审定"></el-step>
								</el-steps>
								<div style="height: 40px"></div>

							</li>
						</ul>
					</div>


				</div>

			</el-scrollbar>

			<!-- 任务分配modal -->
			<el-dialog title="任务分配" :visible.sync="addTaskAssignmentDialogVisible" width="30%">
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">任务名称：</label>
					<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="addTaskAssignment.taskName">
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">任务级别：</label>
					<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="addTaskAssignment.taskLevel">
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">开始时间：</label>
					<el-date-picker	v-model="addTaskAssignment.startTime" type="date" placeholder="选择日期" style="width: 80%"></el-date-picker>
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">截止时间：</label>
					<el-date-picker	v-model="addTaskAssignment.stopTime" type="date" placeholder="选择日期"  style="width: 80%"></el-date-picker>
				</div>
				<div class="modal-footer">
					<button  class="btn btn-primary" @click="saveAddTaskAssignment">保存</button>
				</div>
			</el-dialog>


			<!-- 人员项目信息modal -->
			<el-dialog title="人员项目信息" :visible.sync="userProjectsDialogVisible" width="80%">
				<el-table style="width: 100%;margin-top: 10px;" :data="userProjectsTableData" class="x-table table-td0">
					<!--<el-table-column type="selection" width="55"></el-table-column>-->
					<el-table-column label="姓名">
						<template slot-scope="scope">
								 <el-link type="primary">{{ scope.row.username }}</el-link>
						</template>
					</el-table-column>
					<el-table-column label="状态">
						<template slot-scope="scope"><a  target="_blank">{{ scope.row.tripState }} </a></template>
					</el-table-column>
					<!--<el-table-column  label="已完成工作量">-->
						<!--<template slot-scope="scope"><span>{{ scope.row.finishedWorkload }}</span></template>-->
					<!--</el-table-column>-->
					<!--<el-table-column  label="目前工作量">-->
						<!--<template slot-scope="scope"><span>{{ scope.row.currentWorkload }}</span></template>-->
					<!--</el-table-column>-->
					<el-table-column label="项目名称">
						<template slot-scope="scope"><a  target="_blank">{{ scope.row.projectName }} </a></template>
					</el-table-column>
					<el-table-column label="设计阶段">
						<template slot-scope="scope"><span>{{ scope.row.designPhase }}</span></template>
					</el-table-column>
					<el-table-column label="任务级别">
						<template slot-scope="scope"><span>{{ scope.row.taskLevel }}</span></template>
					</el-table-column>
					<el-table-column label="开始时间">
						<template slot-scope="scope"><span>{{ scope.row.startTime }}</span></template>
					</el-table-column>
					<el-table-column  label="截止时间">
						<template slot-scope="scope"><span>{{ scope.row.stopTime }}</span></template>
					</el-table-column>
					<el-table-column  label="剩余天数">
						<template slot-scope="scope"><span>{{ scope.row.leftTime }}</span></template>
					</el-table-column>
					<el-table-column  label="目前进度">
						<template slot-scope="scope">
										<span>
											<div class="progress" :hidden="scope.row.hidden">
											  <div class="progress-bar" role="progressbar" :style="'width: '+ scope.row.currentProcess + '%;'" aria-valuenow="scope.row.currentProcess" aria-valuemin="0" aria-valuemax="100">{{ scope.row.currentProcess }}%</div>
											</div>
										</span></template>
					</el-table-column>

					<el-table-column label="备注">
						<template slot-scope="scope"><span>{{ scope.row.role }}</span></template>
					</el-table-column>
					<el-table-column label="操作">
						<template slot-scope="scope">
							<el-button type="primary" @click="saveUser(scope.row.username)">确定</el-button>
							<span></span>
						</template>
					</el-table-column>
				</el-table>
				<el-pagination class="txtCenter"
							   @size-change="handleSizeChange"
							   @current-change="handleCurrentChange"
							   :current-page.sync="currentPage"
							   :page-sizes="[10,20,30,50]"
							   :page-size="100"
							   layout=" sizes, prev, pager, next"
							   :total="1000">
				</el-pagination>
			</el-dialog>

			<!-- 上序资料modal -->
			<el-dialog title="上序资料" :visible.sync="previousProfileDialogVisible" width="80%">
				<nav>
					<div class="nav nav-tabs" role="tablist" v-for="item, key in previousProfileTabs" :key="key">
						<a style="display: inline-block" :class="item.style" @click="getPreviousProfileByTabId(item.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{item.name}}</a>
					</div>
				</nav>
				<el-button type="primary" @click="addPreviousProfileClick" :hidden="addPreviousProfileHidden">添加</el-button>
				<div style="height: 5px"></div>
				<el-table style="width: 100%;" :data="previousProfileTableData" class="x-table table-td0">
					<el-table-column type="selection" width="55"></el-table-column>
					<!--<el-table-column label="序号" width="60" type="index">-->
					<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
					<!--</el-table-column>-->
					<el-table-column label="上序专业">
						<template slot-scope="scope"><a target="_blank" >{{ scope.row.departmentName }} </a></template>
					</el-table-column>
					<el-table-column label="内容">
						<template slot-scope="scope"><span>{{ scope.row.content }}</span></template>
					</el-table-column>
					<el-table-column  label="提的文件名">
						<template slot-scope="scope"><span>{{ scope.row.fileName }}</span></template>
					</el-table-column>
					<el-table-column  label="上传日期">
						<template slot-scope="scope"><span>{{ scope.row.uploadDate }}</span></template>
					</el-table-column>
					<el-table-column  label="技表日期">
						<template slot-scope="scope"><span>{{ scope.row.checkDate }}</span></template>
					</el-table-column>

					<el-table-column  label="备注">
						<template slot-scope="scope"><span>{{ scope.row.dealOpinions }}</span></template>
					</el-table-column>

					<el-table-column  label="操作">
						<template slot-scope="scope">
							<button type="button" class="btn btn-info" @click="acceptPreviousProfile(scope.row)">接收</button>
							<button type="button" class="btn btn-danger" @click="refusePreviousProfile(scope.row)">退回</button>
						</template>
					</el-table-column>


				</el-table>
				<el-pagination class="txtCenter"
							   @size-change="handleSizeChange"
							   @current-change="handleCurrentChange"
							   :current-page.sync="currentPage"
							   :page-sizes="[10,20,30,50]"
							   :page-size="100"
							   layout=" sizes, prev, pager, next"
							   :total="1000">
				</el-pagination>
			</el-dialog>

			<!-- 下序资料modal -->
			<el-dialog title="下序资料" :visible.sync="nextProfessionProfileDialogVisible" width="80%">
				<!--<div style="margin-bottom: 5px">-->
					<!--<el-button type="primary" @click="showAddNextProfessionDialog">添加</el-button>-->
				<!--</div>-->

				<nav>
					<div class="nav nav-tabs" role="tablist" v-for="item, key in nextProfessionProfileTabs" :key="key">
						<a style="display: inline-block" :class="item.style" @click="getNextProfessionProfileByTabId(item.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{item.name}}</a>
					</div>
				</nav>
				<div style="height: 5px"></div>
				<el-table style="width: 100%;" :data="nextProfessionProfileTableData" class="x-table table-td0">
					<el-table-column type="selection" width="55"></el-table-column>
					<el-table-column label="内容">
						<template slot-scope="scope"><span>{{ scope.row.content }}</span></template>
					</el-table-column>
					<el-table-column  label="文件名">
						<template slot-scope="scope">

						</template>
					</el-table-column>
					<el-table-column  label="上传日期">
						<template slot-scope="scope"><span>{{ scope.row.uploadDate }}</span></template>
					</el-table-column>
					<el-table-column  label="技表日期">
						<template slot-scope="scope"><span>{{ scope.row.checkDate }}</span></template>
					</el-table-column>
					<el-table-column  label="下序专业">
						<template slot-scope="scope">
							<!--<el-select v-model="statestype" placeholder="请选择">-->
								<!--<el-option v-for="item in statestypeoptions" :key="item.value" :label="item.label" :value="item.value">-->
								<!--</el-option>-->
							<!--</el-select>-->
						</template>
					</el-table-column>
					<el-table-column  label="发送">
						<template slot-scope="scope">
							<button type="button" class="btn btn-success">发送</button>
						</template>
					</el-table-column>
					<el-table-column  label="备注">
						<template slot-scope="scope"><span>{{ scope.row.dealOpinions }}</span></template>
					</el-table-column>
				</el-table>
				<el-pagination class="txtCenter"
							   @size-change="handleSizeChange"
							   @current-change="handleCurrentChange"
							   :current-page.sync="currentPage"
							   :page-sizes="[10,20,30,50]"
							   :page-size="100"
							   layout=" sizes, prev, pager, next"
							   :total="1000">
				</el-pagination>
			</el-dialog>

			<!--专业项目文件-->
			<el-dialog title="专业项目文件" :visible.sync="profileTreeDialogVisible" width="30%">
				<el-form ref="form" :model="form" label-width="110px">
					<el-upload
							class="upload-demo"
							:action="'/crud/profile/uploadFile?projectId=' + projectId"
							:on-change="handleChange"
							:file-list="fileList">
						<el-button size="small" type="primary">点击上传</el-button>
					</el-upload>
				</el-form>
			</el-dialog>

			<!-- 添加上序文件Modal -->
			<el-dialog title="添加我需要的上序文件" :visible.sync="addPreviousProfileDialogVisible" width="30%">
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">上序分项目：</label>
					<el-select v-model="selectDepartments" multiple placeholder="请选择"  style="width: 80%">
						<el-option
								v-for="department in departments"
								:key="department.id"
								:label="department.departmentName"
								:value="department.id">
						</el-option>
					</el-select>
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">内容：</label>
					<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="content">
				</div>
				<div class="modal-footer">
					<button  class="btn btn-primary" @click="saveAddPreviousProfileDialog">保存</button>
				</div>
			</el-dialog>


		</div>
	</div>

	<script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js" th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script>
	<script type="text/javascript" src="asserts/js/popper.min.js" th:src="@{/webjars/popper.js/1.11.1/dist/popper.js}"></script>
	<script type="text/javascript" src="asserts/js/bootstrap.min.js" th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>

	<script type="text/javascript" src="asserts/js/feather.min.js" th:src="@{/asserts/js/feather.min.js}"></script>
	<script type="text/javascript" src="asserts/js/vue.js" th:src="@{/asserts/js/vue.js}"></script>
	<script type="text/javascript" src="asserts/js/iconfont.js" th:src="@{/asserts/js/iconfont.js}"></script>
	<script type="text/javascript" src="asserts/js/const.js" th:src="@{/asserts/js/const.js}"></script>
	<script type="text/javascript" src="asserts/element2.10.1/index.js" th:src="@{/asserts/element2.10.1/index.js}"></script>


	<script>
		feather.replace()
	</script>

	<script th:inline="javascript" type="text/javascript">

		const cityOptions = ['上海', '北京', '广州', '深圳'];

		var app = new Vue({
			el: '#app',
			data: {
				addTaskAssignmentDialogVisible: false,
				userProjectsDialogVisible: false,
				previousProfileDialogVisible: false,
				nextProfessionProfileDialogVisible: false,
				profileTreeDialogVisible: false,
				addPreviousProfileDialogVisible: false,
				detailTableHidden: false,
				flowChartTableHidden: true,
				currentPage: 1,
				previousProfileTabId: 0,
				nextProfessionProfileTabId: 0,
				projectSummaryId: null,
				departmentId: null,
				projectId: null,
				selectTaskId: null,
				selectUserRole: null,
				project: {},
				projects:{},
				addTaskAssignment:{},
				departments: {},
				isActive: true,
				projectClass1: "m-a cur",
				taskAssignmentListData: null,
				userProjectsTableData: null,
				previousProfileTableData: null,
				nextProfessionProfileTableData: null,
				addNextProfessionProfile: null,
				addPreviousProfileHidden: true,
				selectDepartments: null,
				content: null,
				fileType: 'text/plain',
				form: {
					category: ''
				},
				navigationBars:[
					{
						id: 1,
						name: "信息列表",
						style:"nav-item nav-link active"
					},
					{
						id: 2,
						name: "流程图",
						style:"nav-item nav-link"
					}
				],
				previousProfileTabs: [
					{
						id: 0,
						name: "我收到的",
						style: "nav-item nav-link active",
					},
					{
						id: 1,
						name: "我申请的",
						style: "nav-item nav-link",
					}
				],
				nextProfessionProfileTabs: [
					{
						id: 0,
						name: "我发起的",
						style: "nav-item nav-link active",
					},
					{
						id: 1,
						name: "被需要的",
						style: "nav-item nav-link",
					}
				],
				fileList: [],
				checkAll: false,
				checkedCities: ['上海', '北京'],
				cities: cityOptions,
				isIndeterminate: true,
			},
			methods: {
				handleSizeChange(val) {
					console.log(`每页 ${val} 条`);
				},
				handleCurrentChange(val) {
					console.log(`当前页: ${val}`);
				},
				showProjectById: function(id){
					// console.log("应该显示 " + id)
					var ajaxData = {}
					ajaxData.projectId = id
					//更改li颜色
					var myProjects = app.projects
					for(var i = 0; i < myProjects.length; i++){
						if(myProjects[i].id == id){
							myProjects[i].deltag = 'm-a cur'
							app.projectId = myProjects[i].id
							app.departmentId = myProjects[i].departmentId
							findByProjectId();//根据分项目查询该分项目下的任务分配情况
						}else{
							myProjects[i].deltag = ''
						}
					}
					app.projects = myProjects
					app.fileList = []
				},
				switchNavigationBar: function (id) {
					var navigationBars = app.navigationBars
					for(var i = 0; i < navigationBars.length; i++){
						if(id == navigationBars[i].id){
							navigationBars[i].style = "nav-item nav-link active"
						}else{
							navigationBars[i].style = "nav-item nav-link"
						}
					}
					if(id == 1){
						app.detailTableHidden = false
						app.flowChartTableHidden = true
					}else if(id == 2){
						app.detailTableHidden = true
						app.flowChartTableHidden = false
					}

				},
				//添加任务按钮
				addTaskAssignmentClick: function () {
					app.addTaskAssignmentDialogVisible = true
				},
				//保存新添加的任务
				saveAddTaskAssignment: function () {
					var that = this
					var addTaskAssignment = app.addTaskAssignment
					addTaskAssignment.projectId = app.projectId
					var ajaxData = {}

					ajaxData.taskAssignment = encodeURI(JSON.stringify(addTaskAssignment))
					$.ajax({
						data: ajaxData,
						type: "GET",
						url: "/crud/taskAssignment/addTaskAssignment",
						traditional: true,
						success: function (result) {
							if(result.code == 200){
								findByProjectId();//根据分项目查询该分项目下的任务分配情况
								app.addTaskAssignmentDialogVisible = false
								app.addTaskAssignment = {}
								that.$message({
									message: '任务添加成功',
									type: 'success'
								});
							}else{
								console.log("返回值失败 addTaskAssignment")
							}

						}
					})
				},
				//编辑设计人员
				editDesignerClick: function (taskId) {
					app.selectTaskId = taskId
					app.selectUserRole = "designer"
					app.userProjectsDialogVisible = true
					findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
				},
				//编辑复核人员
				editReviewerClick: function (taskId) {
					app.selectTaskId = taskId
					app.selectUserRole = "reviewer"
					app.userProjectsDialogVisible = true
					findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
				},
				//编辑审核人员
				editInspectorClick: function (taskId) {
					app.selectTaskId = taskId
					app.selectUserRole = "inspector"
					app.userProjectsDialogVisible = true
					findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
				},
				//编辑审定人员
				editValidationerClick: function (taskId) {
					app.selectTaskId = taskId
					app.selectUserRole = "validationer"
					app.userProjectsDialogVisible = true
					findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
				},
				//保存选中的人员
				saveUser: function(username){
					var ajaxData = {}
					ajaxData.departmentId = app.departmentId
					ajaxData.selectTaskId = app.selectTaskId
					ajaxData.selectUserRole = app.selectUserRole
					ajaxData.username = encodeURI(JSON.stringify(username))

					console.log(ajaxData)

					editEngineer(ajaxData, this);//编辑分任务的设计、复核、审核、审定人员
				},
				//显示上序资料dialog
				showPreviousProfileDialog: function(){
					app.previousProfileDialogVisible = true
					findPreviousProfile(0);//查找上序资料列表
				},
				//根据tab切换上序文件（我收到的、我申请的）
				getPreviousProfileByTabId: function (tabId) {
					app.previousProfileTabId = tabId
					var previousProfileTabs = app.previousProfileTabs
					for(var i = 0; i < previousProfileTabs.length; i++){
						if(i == tabId){
							previousProfileTabs[i].style = 'nav-item nav-link active'
						}else{
							previousProfileTabs[i].style = 'nav-item nav-link'
						}
					}
					app.previousProfileTabs = previousProfileTabs
					findPreviousProfile(tabId);//查找上序资料列表
					if(tabId == 1){
						app.addPreviousProfileHidden = false
					}else{
						app.addPreviousProfileHidden = true
					}
				},
				//显示下序资料dialog
				showNextProfessionProfileDialog: function(){
					app.nextProfessionProfileDialogVisible = true
					findNextProfessionProfile(0);//查找下序资料
				},
				//根据tab切换下序资料（我发起的、需要我发送的）
				getNextProfessionProfileByTabId: function(tabId){
					var nextProfessionProfileTabs = app.nextProfessionProfileTabs
					for(var i = 0; i < nextProfessionProfileTabs.length; i++){
						if(i == tabId){
							nextProfessionProfileTabs[i].style = 'nav-item nav-link active'
						}else{
							nextProfessionProfileTabs[i].style = 'nav-item nav-link'
						}
					}
					app.nextProfessionProfileTabs = nextProfessionProfileTabs
					findNextProfessionProfile(tabId);//查找上序资料列表
				},
				//显示文件树对话框
				openProfileTreeDialog: function(){
					app.fileList = []
					app.profileTreeDialogVisible = true
					findFilesByProjectId();//查找文件树内容
				},
				uploadDocs: function (params) {
					//TODO OSS文件上传可以在前端直接配置
					console.log(params.file.name)
				},
				beforeUploadDoc: function (file) {
					console.log("beforeUploadDoc function")
					console.log(file)
				},
				handleChange(file, fileList) {
					console.log(file)
					console.log(fileList)
					// this.fileList = fileList.slice(-3);
					this.fileList = fileList;
				},
				//接收上序文件
				acceptPreviousProfile: function (professionProfile) {
					professionProfile.dealFlag = 0;//接收
					professionProfile.dealOpinions = "接收";
					var ajaxData = {}
					ajaxData.professionProfile = encodeURI(JSON.stringify(professionProfile))
					console.log(professionProfile)
					updateProfessionProfile(ajaxData);//更新专业文件数据
					this.$message({
						message: '接收成功',
						type: 'success'
					});
				},
				//退回上序文件
				refusePreviousProfile: function (professionProfile) {
					this.$prompt('请输入驳回意见', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
					}).then(({ value }) => {
						professionProfile.dealFlag = 1;//驳回
						professionProfile.dealOpinions = value;
						var ajaxData = {}
						ajaxData.professionProfile = encodeURI(JSON.stringify(professionProfile))
						updateProfessionProfile(ajaxData);//更新专业文件数据
						this.$message({
							message: '驳回成功',
							type: 'success'
						});
					}).catch(() => {
						this.$message({
							type: 'info',
							message: '取消输入'
						});
					});
				},
				//添加我需要的上序文件
				addPreviousProfileClick:function () {
					var projects = app.projects
					var departments = new Array()
					for(var i = 0; i< projects.length; i++){
						if(projects[i].id != app.projectId){
							var department = {};
							department.id = projects[i].id
							department.departmentName = projects[i].departmentName
							departments.push(department)
						}
					}
					app.departments = departments
					console.log(app.departments)
					app.addPreviousProfileDialogVisible = true;
				},
				//保存我添加的需要别人提供给我的上序文件
				saveAddPreviousProfileDialog: function () {
					var ajaxData = {}
					ajaxData.content = app.content
					ajaxData.selectProjectIds = app.selectDepartments
					console.log(ajaxData)
					ajaxData.projectId = app.projectId
					addPreviousProfessionProfile(ajaxData);//添加我需要别人提供给我的上序资料
				}

			}

		})

		var projectList =[[ ${projectList}]]
		var departmentId =[[ ${departmentId}]]
		console.log(projectList)
		console.log(departmentId)

		app.projects = projectList
		app.projectSummaryId = projectList[0].projectSummaryId

		app.departmentId = departmentId

		for(var i = 0; i < projectList.length; i++){
			if(projectList[i].deltag == "m-a cur"){
				app.projectId = projectList[i].id
			}
		}

		findByProjectId();//根据分项目查询该分项目下的任务分配情况

		/**
		 * 根据分项目查询该分项目下的任务分配情况
		 */
		function findByProjectId() {
			var ajaxData = {}
			ajaxData.projectId = app.projectId
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/taskAssignment/findByProjectId",
				success: function (result) {
					if(result.code == 200){
						app.taskAssignmentListData=result.data
					}else{
						console.log("updatePrincipal 返回值失败")
					}

				}
			})
		}

		/**
		 * 根据部门id查找人员项目信息
 		 */
		function findUserProjectsByDeptIdAndRole(){
			var ajaxData = {}
			ajaxData.departmentId = app.departmentId
			ajaxData.selectUserRole = app.selectUserRole
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/userProject/findUserProjectsByDeptIdAndRole",
				success: function (result) {
					if(result.code == 200){
						app.userProjectsTableData=result.data
					}else{
						console.log("findUserProjectsByDeptIdAndRole 返回值失败")
					}

				}
			})
		}

		/**
		 * 编辑分任务的设计、复核、审核、审定人员
		 * @param ajaxData
		 */
		function editEngineer(ajaxData, that){
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/taskAssignment/editEngineer",
				success: function (result) {
					if(result.code == 200){
						showEditSuccessMessgae(that);//显示设计、复核、审核、审定编辑成功消息
						app.selectTaskId = null
						app.selectUserRole = null
						app.userProjectsDialogVisible = false
						findByProjectId();//根据分项目查询该分项目下的任务分配情况
					}else{
						console.log("editEngineer 返回值失败")
					}

				}
			})
		}

		/**
		 * 显示编辑成功消息
		 * @param that
		 */
		function showEditSuccessMessgae(that){
			if("designer" == app.selectUserRole){
				that.$message({
					message: "设计人员编辑成功",
					type: 'success'
				});
			}else if("reviewer" == app.selectUserRole){
				that.$message({
					message: "复核人员编辑成功",
					type: 'success'
				});
			}else if("inspector" == app.selectUserRole){
				that.$message({
					message: "审核人员编辑成功",
					type: 'success'
				});
			}else if("validationer" == app.selectUserRole){
				that.$message({
					message: "审定人员编辑成功",
					type: 'success'
				});
			}


		}

		/**
		 * 查找上序资料列表
		 * @param projectId
		 * @param flag
		 */
		function findPreviousProfile(flag){
			var ajaxData = {}
			ajaxData.projectId = app.projectId
			var url = "/crud/previousProfile/findMyReceivedPreviousProfile"	//我收到的上序资料
			if(flag == 1){
				url = "/crud/previousProfile/findMyInitiatedPreviousProfile" //我主动需要的上序资料
			}
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: url,
				success: function (result) {
					if(result.code == 200){
						app.previousProfileTableData = result.data
					}else{
						console.log("findPreviousProfile 返回值失败")
					}

				}
			})
		}

		/**
		 * 查找下序资料列表
		 * @param projectId
		 * @param flag
		 */
		function findNextProfessionProfile(flag){
			var ajaxData = {}
			ajaxData.projectId = app.projectId
			var url = "/crud/previousProfile/findMySubmitProfileToNextProfession"	//我发起的下序资料
			if(flag == 1){
				url = "/crud/previousProfile/findMyNeededProfileToNextProfession" //别人向我要的资料
			}
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: url,
				success: function (result) {
					if(result.code == 200){
						app.nextProfessionProfileTableData = result.data
					}else{
						console.log("findNextProfessionProfile 返回值失败")
					}

				}
			})
		}


		/**
		 * 查找文件树
		 */
		function findFilesByProjectId(){
			var ajaxData = {}
			ajaxData.projectId = app.projectId
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/profile/findFilesByProjectId",
				success: function (result) {
					if(result.code == 200){
						app.fileList = result.data
					}else{
						console.log("findFilesByProjectId 返回值失败")
					}

				}
			})
		}

		/**
		 * 更新专业文件数据，接收、驳回
		 */
		function updateProfessionProfile(ajaxData){
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/previousProfile/update",
				success: function (result) {
					if(result.code == 200){
						findPreviousProfile(app.previousProfileTabId);//查找上序资料列表
					}else{
						console.log("updateProfessionProfile 返回值失败")
					}

				}
			})
		}

		/**
		 *  添加我需要别人提供给我的上序资料
		 */
		function addPreviousProfessionProfile(ajaxData){
			$.ajax({
				data: ajaxData,
				type: "GET",
				url: "/crud/previousProfile/addPreviousProfessionProfile",
				traditional: true,
				success: function (result) {
					if(result.code == 200){
						app.addPreviousProfileDialogVisible = false
						findPreviousProfile(app.previousProfileTabId);//查找上序资料列表
					}else{
						console.log("addPreviousProfessionProfile 返回值失败")
					}

				}
			})
		}






	</script>
</div>
</body>
</html>