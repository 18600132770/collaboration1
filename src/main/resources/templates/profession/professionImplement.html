<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-on="http://www.w3.org/1999/xhtml"
		xmlns:v-bind="http://www.w3.org/1999/xhtml"
		layout:decorate="layout/index">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>协同平台</title>

	<!-- <link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet"> -->
	<!-- <link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet"> -->
	<!-- <link href="asserts/element2.10.1/index.css" th:href="@{/asserts/element2.10.1/index.css}" rel="stylesheet"> -->
	<!-- <link href="asserts/css/myCSS.css" th:href="@{/asserts/css/myCSS.css}" rel="stylesheet"> -->
	<!-- <link href="asserts/css/myManager.css" th:href="@{/asserts/css/myManager.css}" rel="stylesheet"> -->
	<!-- <link href="asserts/css/myCutWord.css" th:href="@{/asserts/css/myCutWord.css}" rel="stylesheet"> -->
	<link href="asserts/css/new-style.css" th:href="@{/asserts/css/new-style.css}" rel="stylesheet">

	<style>
		.el-menu-vertical-demo:not(.el-menu--collapse) {
			/* width: 200px; */
			min-height: 400px;
		}
		.el-menu-vertical-demo .el-menu-item.is-active {
			color: #fff;
			background: #409EFF;
		}

		.custom-tree-node {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 14px;
        padding-right: 8px;
      }

      .custom-tree-node > span:first-child {
        text-overflow: ellipsis;
        background-color: #409EFF;
        padding: 2px 5px;
        color: #fff;
        width: 200px;
        overflow: hidden;
      }

      .add-project {
        display: flex;
      }
      .tree-container {
        padding: 10px;
        width: 300px;
      }
      .tree-container .el-tree {
        width: 100%;
      }
      .tree-container .el-tree-node {
        margin: 10px 0;
      }
	</style>
</head>

<body>
<div id="flw">
	<div layout:fragment="content">
		<div class="dsource-wrap">
			<el-container>
				<el-aside width="250px">
					<div class="project-title">
						<span>项目列表</span>
						<el-tooltip v-if="false" class="item" effect="dark" content="添加项目" placement="bottom">
							<el-button v-if="false" type="text" icon="el-icon-plus" size="small" @click="addProjectClick"></el-button>
						</el-tooltip>
					</div>
					<!-- 左侧  -->
					<el-scrollbar class="dictionary-l" style="height: calc(100% - 51px);">
						<el-menu
							ref="elMenu"
							:default-active="selectMenuIndex"
							class="el-menu-vertical-demo"
							@select="onMenuSelect"
							@open="onOpen"
							:default-openeds="defaultOpeneds"
						>
							<el-submenu :index="index" v-for="project, index in projects" :key="index">
								<template slot="title">
									<span>{{project.projectName}}</span>
								</template>
								<el-menu-item 
									:index="`${index}-${i}`" 
									v-for="item, i in project.children" 
									:key="`${index}-${i}`"
									@click="showProjectById(item)"
								>{{item.departmentName}}</el-menu-item>
							</el-submenu>
						</el-menu>

						<!-- <ul class="manager-nav dictionary-nav">
							<li 
								class="m-a" 
								v-for="project, key in projects" 
								@click="showProjectById(project.id)" 
								:key="key" 
								:class="{'active': projectId === project.id }"
							>
								<a :class="project.deltag" >{{project.projectName}}</a>
							</li>
						</ul> -->
					</el-scrollbar>
				</el-aside>
				<el-main>
					<el-scrollbar class="dsource-r">
						<el-input hidden="true" v-show="false"  v-model="projectSummaryId" style="height: 0px" ></el-input>
						<el-input hidden="true" v-show="false"  v-model="departmentId" style="height: 0px" ></el-input>
						<el-input hidden="true" v-show="false"  v-model="projectId"  style="height: 0px"></el-input>
						<el-input hidden="true" v-show="false"  v-model="selectUserRole"  style="height: 0px"></el-input>
						<el-input hidden="true" v-show="false"  v-model="selectTaskId"  style="height: 0px"></el-input>
						<el-input hidden="true" v-show="false"  v-model="previousProfileTabId"  style="height: 0px"></el-input>
						<el-input hidden="true" v-show="false"  v-model="nextProfessionProfileTabId"  style="height: 0px"></el-input>
						<el-input hidden="true" v-show="false"  v-model="taskAssignmentId"  style="height: 0px"></el-input>

						<div class="btn-group">
							<el-button type="primary" size="small" @click="addTaskAssignmentClick">
								<i class="el-icon-circle-plus"></i> 添加任务
							</el-button>
							<el-button type="primary" size="small" @click="showPreviousProfileDialog">
								<i class="el-icon-s-fold"></i> 上序资料
							</el-button>
							<el-button type="primary" size="small" @click="showNextProfessionProfileDialog">
								<i class="el-icon-s-unfold"></i> 提下序
							</el-button>
							<el-button type="primary" size="small" @click="openProfileTreeDialog">
								<i class="el-icon-document" style="font-size: 15px"></i> 专业文件
							</el-button>
						</div>
	
						<nav class="navbar navbar-light bg-light">
							<span style="display: inline-block;">项目编号：{{project.projectNum}}</span>
							<span style="display: inline-block;">项目名称：{{project.projectName}}</span>
							<span style="display: inline-block;">项目阶段：{{project.designPhase}}</span>
							<span style="display: inline-block;">开始时间：{{project.startTime}}</span>
							<span style="display: inline-block;">截止时间：{{project.stopTime}}</span>
							<span style="display: inline-block;">负责人：{{project.principal}}</span>
							<span style="display: inline-block;">总工：{{project.chiefEngineer}}</span>
						</nav>
		
						<div class="ds-table-wrap" >
							<!--<img  th:src="@{/asserts/img/1.PNG}">-->
							<nav>
								<div class="nav nav-tabs" role="tablist" v-for="navigationBar, key in navigationBars" :key="key">
									<a style="display: inline-block" :class="navigationBar.style" @click="switchNavigationBar(navigationBar.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{navigationBar.name}}</a>
								</div>
							</nav>
		
							<div :hidden="detailTableHidden" style="margin-top: 10px">
								<el-table style="width: 100%;" :data="taskAssignmentListData" class="x-table table-td0" 
									stripe
									highlight
								>
									<el-table-column type="selection" width="55"></el-table-column>
									<!--<el-table-column label="序号" width="60" type="index">-->
									<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
									<!--</el-table-column>-->
									<el-table-column label="任务">
										<template slot-scope="scope"><span>{{ scope.row.taskName }}</span></template>
									</el-table-column>
									<el-table-column label="任务级别">
										<template slot-scope="scope"><span>{{ scope.row.taskLevel }}</span></template>
									</el-table-column>
									<el-table-column label="设计">
										<template slot-scope="scope">
											<div @click="editDesignerClick(scope.row)">
													<span  style="color: #080fe8">
													<el-link type="primary">{{ scope.row.designer }}</el-link>
												</span>
											</div>
										</template>
									</el-table-column>
									<el-table-column  label="复核">
										<template slot-scope="scope">
											<div @click="editReviewerClick(scope.row)">
													<span  style="color: #080fe8">
													<el-link type="primary">{{ scope.row.reviewer }}</el-link>
												</span>
											</div>
										</template>
									</el-table-column>
									<el-table-column  label="审核">
										<template slot-scope="scope">
											<div @click="editInspectorClick(scope.row)">
													<span  style="color: #080fe8">
													<el-link type="primary">{{ scope.row.inspector }}</el-link>
												</span>
											</div>
										</template>
									</el-table-column>
									<el-table-column  label="审定">
										<template slot-scope="scope">
											<div @click="editValidationerClick(scope.row)">
													<span  style="color: #080fe8">
													<el-link type="primary">{{ scope.row.validationer }}</el-link>
												</span>
											</div>
										</template>
									</el-table-column>
									<el-table-column label="送审文件">

									</el-table-column>
									<el-table-column  label="开始时间">
										<template slot-scope="scope"><span>{{ scope.row.startTime }}</span></template>
									</el-table-column>
									<el-table-column  label="截止时间">
										<template slot-scope="scope"><span>{{ scope.row.stopTime }}</span></template>
									</el-table-column>
									<el-table-column label="操作" width="150">
										<template slot-scope="scope">
											<el-button type="primary" size="mini" @click="showFlowChart(scope.row.id)">审批</el-button>
											<el-button type="danger" size="mini" @click="deleteTask(scope.row.id)">删除</el-button>
										</template>
									</el-table-column>
								</el-table>
								<el-pagination class="txtCenter pagination"
									background
									@size-change="handleSizeChangeTaskAssignmentListData"
									@current-change="handleCurrentChangeTaskAssignmentListData"
									:current-page.sync="currentPageTaskAssignmentListData"
									:page-sizes="[10,20,30,50]"
									:page-size="100"
									layout=" sizes, prev, pager, next"
									:total="totalTaskAssignmentListData">
								</el-pagination>
							</div>
		
							<div :hidden="flowChartTableHidden" style="margin-top: 20px">
								<ul>
									<li v-for="taskAssignmentData, index in taskAssignmentListData" :key="index">
										<el-steps :active="taskAssignmentData.finishedLevel" align-center>
											<el-link type="primary" style="width: 150px; color: #fb2e8c; font-size: 15px">{{taskAssignmentData.taskName}}</el-link>
											<el-step :title="taskAssignmentData.designer" @click.native="designerReviewProcessClick(taskAssignmentData.id)" description="设计"></el-step>
											<el-step :title="taskAssignmentData.reviewer" @click.native="reviewerReviewProcessClick(taskAssignmentData.id)" description="复核"></el-step>
											<el-step :title="taskAssignmentData.inspector" @click.native="inspectorReviewProcessClick(taskAssignmentData.id)" description="审核"></el-step>
											<el-step :title="taskAssignmentData.validationer" @click.native="validationerReviewProcessClick(taskAssignmentData.id)" description="审定"></el-step>
										</el-steps>
										<div style="height: 40px"></div>
									</li>
								</ul>
							</div>
						</div>
					</el-scrollbar>
				</el-main>
			</el-container>

			<el-scrollbar class="dictionary-l" style="width: 120px; border:0;margin-top: 0px; background-color: #f4f3fb" >
				<el-input hidden="true" v-show="false"  v-model="pageSizeTaskAssignmentListData"  style="height: 0px"></el-input>
				<el-input hidden="true" v-show="false"  v-model="pageSizeUserProjectsTableData"  style="height: 0px"></el-input>
				<el-input hidden="true" v-show="false"  v-model="pageSizepreviousProfileTableData"  style="height: 0px"></el-input>
				<el-input hidden="true" v-show="false"  v-model="pageSizeNextProfessionProfileTableData"  style="height: 0px"></el-input>
				<!--<el-radio-group v-model="isCollapse" style="margin-bottom: 20px;">-->
					<!--<el-radio-button :label="false">展开</el-radio-button>-->
					<!--<el-radio-button :label="true">收起</el-radio-button>-->
				<!--</el-radio-group>-->
				<!-- <el-menu default-active="1-4-1" class="el-menu-vertical-demo" :collapse="isCollapse">
					<el-menu-item index="1">
						<i class="el-icon-circle-plus" @click="addTaskAssignmentClick" style="font-size: 15px">添加任务</i>
						<span slot="title" @click="addTaskAssignmentClick">添加任务</span>
					</el-menu-item>
					<el-menu-item index="2">
						<i class="el-icon-s-fold" @click="showPreviousProfileDialog" style="font-size: 15px">上序资料</i>
						<span slot="title" @click="showPreviousProfileDialog">上序资料</span>
					</el-menu-item>
					<el-menu-item index="3">
						<i class="el-icon-s-unfold" @click="showNextProfessionProfileDialog" style="font-size: 15px">提下序</i>
						<span slot="title" @click="showNextProfessionProfileDialog">提下序</span>
					</el-menu-item>
					<el-menu-item index="4">
						<i class="el-icon-document" @click="openProfileTreeDialog" style="font-size: 15px">专业文件</i>
						<span slot="title" @click="openProfileTreeDialog">专业文件</span>
					</el-menu-item>
				</el-menu> -->

			</el-scrollbar>


			<!-- 任务分配modal -->
			<el-dialog title="添加任务" :visible.sync="addTaskAssignmentDialogVisible" width="600px">
				<el-form size="small" label-width="130px" label-suffix="：">
					<el-form-item label="任务名称">
						<el-input placeholder="请输入任务名称" clearable v-model="addTaskAssignment.taskName" style="width: 300px;"></el-input>
					</el-form-item>
					<el-form-item label="任务级别">
						<!-- <el-input placeholder="请输入任务级别" clearable v-model="addTaskAssignment.taskLevel" style="width: 300px;"></el-input> -->
						<el-select clearable v-model="addTaskAssignment.taskLevel" style="width: 300px;">
							<el-option label="紧急" value="紧急"></el-option>
							<el-option label="正常" value="正常"></el-option>
						</el-select>
					</el-form-item>
					<el-form-item label="开始时间">
						<el-date-picker	v-model="addTaskAssignment.startTime" type="date" placeholder="选择日期" style="width: 300px;"></el-date-picker>
					</el-form-item>
					<el-form-item label="截止时间">
						<el-date-picker	v-model="addTaskAssignment.stopTime" type="date" placeholder="选择日期" style="width: 300px;"></el-date-picker>
					</el-form-item>
				</el-form>
				<div slot="footer" class="txtCenter">
					<el-button size="small" type="primary" @click="saveAddTaskAssignment">保存</el-button>
					<el-button size="small" @click="addTaskAssignmentDialogVisible = false">取消</el-button>
				</div>
			</el-dialog>


			<!-- 人员工作信息modal -->
			<el-dialog title="人员工作信息" :visible.sync="userProjectsDialogVisible" width="80%">
				<el-scrollbar style="height: 400px;">
					<el-table style="width: 100%;margin-top: 10px;" :data="userProjectsTableData" class="x-table table-td0">
						<!--<el-table-column type="selection" width="55"></el-table-column>-->
						<el-table-column label="姓名">
							<template slot-scope="scope">
									<el-link type="primary">{{ scope.row.username }}</el-link>
							</template>
						</el-table-column>
						<el-table-column label="状态">
							<template slot-scope="scope"><a  target="_blank">{{ scope.row.tripState }} </a></template>
						</el-table-column>
						<!--<el-table-column  label="已完成工作量">-->
							<!--<template slot-scope="scope"><span>{{ scope.row.finishedWorkload }}</span></template>-->
						<!--</el-table-column>-->
						<!--<el-table-column  label="目前工作量">-->
							<!--<template slot-scope="scope"><span>{{ scope.row.currentWorkload }}</span></template>-->
						<!--</el-table-column>-->
						<el-table-column label="项目名称">
							<template slot-scope="scope"><a  target="_blank">{{ scope.row.projectName }} </a></template>
						</el-table-column>
						<el-table-column label="设计阶段">
							<template slot-scope="scope"><span>{{ scope.row.designPhase }}</span></template>
						</el-table-column>
						<el-table-column label="任务级别">
							<template slot-scope="scope"><span>{{ scope.row.taskLevel }}</span></template>
						</el-table-column>
						<el-table-column label="开始时间">
							<template slot-scope="scope"><span>{{ scope.row.startTime }}</span></template>
						</el-table-column>
						<el-table-column  label="截止时间">
							<template slot-scope="scope"><span>{{ scope.row.stopTime }}</span></template>
						</el-table-column>
						<el-table-column  label="剩余天数">
							<template slot-scope="scope"><span>{{ scope.row.leftTime }}</span></template>
						</el-table-column>
						<el-table-column  label="目前进度">
							<template slot-scope="scope">
											<span>
												<div class="progress" :hidden="scope.row.hidden">
													<div class="progress-bar" role="progressbar" :style="'width: '+ scope.row.currentProcess + '%;'" aria-valuenow="scope.row.currentProcess" aria-valuemin="0" aria-valuemax="100">{{ scope.row.currentProcess }}%</div>
												</div>
											</span></template>
						</el-table-column>

						<el-table-column label="备注">
							<template slot-scope="scope"><span>{{ scope.row.role }}</span></template>
						</el-table-column>
						<el-table-column label="操作">
							<template slot-scope="scope">
								<el-button type="primary" size="mini" @click="saveUser(scope.row.username)">确定</el-button>
								<span></span>
							</template>
						</el-table-column>
					</el-table>
				</el-scrollbar>
				<el-pagination class="txtCenter pagination"
					background
					@size-change="handleSizeChangeUserProjectsTableData"
					@current-change="handleCurrentChangeUserProjectsTableData"
					:current-page.sync="currentPageUserProjectsTableData"
					:page-sizes="[10,20,30,50]"
					:page-size="100"
					layout=" sizes, prev, pager, next"
					:total="totalUserProjectsTableData">
				</el-pagination>
			</el-dialog>

			<!-- 上序资料modal -->
			<el-dialog title="上序资料" :visible.sync="previousProfileDialogVisible" width="80%">
				<!-- <nav>
					<div class="nav nav-tabs" role="tablist" v-for="item, key in previousProfileTabs" :key="key">
						<a style="display: inline-block" :class="item.style" @click="getPreviousProfileByTabId(item.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{item.name}}</a>
					</div>
				</nav> -->
				<div class="table-operate">
					<el-radio-group size="small" v-model="profileType" @change="profileChange">
						<el-radio-button v-for="item, key in previousProfileTabs" :key="item.id" :label="item.id">{{item.name}}</el-radio-button>
					</el-radio-group>
					<el-button type="primary" size="small" @click="addPreviousProfileClick" :hidden="addPreviousProfileHidden">添加</el-button>
				</div>
				<div style="height: 5px"></div>
				<el-table style="width: 100%;" :data="previousProfileTableData" class="x-table table-td0">
					<el-table-column type="selection" width="55"></el-table-column>
					<!--<el-table-column label="序号" width="60" type="index">-->
					<!--<template slot-scope="scope"><span>{{ scope.row.serialNumber }}</span></template>-->
					<!--</el-table-column>-->
					<el-table-column label="上序专业">
						<template slot-scope="scope"><a target="_blank" >{{ scope.row.departmentName }} </a></template>
					</el-table-column>
					<el-table-column label="内容">
						<template slot-scope="scope"><span>{{ scope.row.content }}</span></template>
					</el-table-column>
					<el-table-column  label="提的文件名">
							<template slot-scope="scope" @click="download()"><span style="white-space: pre-line">{{ scope.row.fileName }}</span></template>

					</el-table-column>
					<el-table-column  label="上传日期">
						<template slot-scope="scope"><span>{{ scope.row.uploadDate }}</span></template>
					</el-table-column>
					<el-table-column  label="技表日期">
						<template slot-scope="scope"><span>{{ scope.row.checkDate }}</span></template>
					</el-table-column>

					<el-table-column  label="备注">
						<template slot-scope="scope"><span>{{ scope.row.dealOpinions }}</span></template>
					</el-table-column>

					<el-table-column  label="操作">
						<template slot-scope="scope">
							<el-button type="primary" size="mini" @click="acceptPreviousProfile(scope.row)">接收</el-button>
							<el-button size="mini" @click="refusePreviousProfile(scope.row)">退回</el-button>
						</template>
					</el-table-column>


				</el-table>
				<el-pagination class="txtCenter pagination"
					background
					@size-change="handleSizeChangepreviousProfileTableData"
					@current-change="handleCurrentChangepreviousProfileTableData"
					:current-page.sync="currentPagepreviousProfileTableData"
					:page-sizes="[10,20,30,50]"
					:page-size="100"
					layout=" sizes, prev, pager, next"
					:total="totalpreviousProfileTableData">
				</el-pagination>
			</el-dialog>

			<!-- 下序资料modal -->
			<el-dialog title="下序资料" :visible.sync="nextProfessionProfileDialogVisible" width="80%">
				<!--<div style="margin-bottom: 5px">-->
					<!--<el-button type="primary" @click="showAddNextProfessionDialog">添加</el-button>-->
				<!--</div>-->

				<!-- <nav>
					<div class="nav nav-tabs" role="tablist" v-for="item, key in nextProfessionProfileTabs" :key="key">
						<a style="display: inline-block" :class="item.style" @click="getNextProfessionProfileByTabId(item.id)" data-toggle="tab" role="tab" aria-controls="nav-home" aria-selected="true">{{item.name}}</a>
					</div>
				</nav> -->
				<div class="table-operate">
					<el-radio-group size="small" v-model="profileType" @change="nextProfessionProfileChange">
						<el-radio-button v-for="item, key in nextProfessionProfileTabs" :key="item.id" :label="item.id">{{item.name}}</el-radio-button>
					</el-radio-group>
					<el-button type="primary" size="small" @click="addNextProfessionProfileClick" :hidden="addNextProfessionProfileHidden">添加</el-button>
				</div>
				<!-- <div style="height: 5px"></div> -->
				<!-- <el-button type="primary" @click="addNextProfessionProfileClick" :hidden="addNextProfessionProfileHidden">添加</el-button> -->

				<el-table style="width: 100%;" :data="nextProfessionProfileTableData" class="x-table table-td0">
					<el-table-column type="selection" width="55"></el-table-column>
					<el-table-column label="内容">
						<template slot-scope="scope"><span>{{ scope.row.content }}</span></template>
					</el-table-column>
					<el-table-column  label="文件名">
						<template slot-scope="scope">

						</template>
					</el-table-column>
					<el-table-column  label="上传日期">
						<template slot-scope="scope"><span>{{ scope.row.uploadDate }}</span></template>
					</el-table-column>
					<el-table-column  label="技表日期">
						<template slot-scope="scope"><span>{{ scope.row.checkDate }}</span></template>
					</el-table-column>
					<el-table-column  label="下序专业">
						<template slot-scope="scope">
							<!--<el-select v-model="statestype" placeholder="请选择">-->
								<!--<el-option v-for="item in statestypeoptions" :key="item.value" :label="item.label" :value="item.value">-->
								<!--</el-option>-->
							<!--</el-select>-->
						</template>
					</el-table-column>
					<el-table-column  label="发送">
						<template slot-scope="scope">
							<el-button type="primary" size="mini" class="btn btn-success">发送</el-button>
						</template>
					</el-table-column>
					<el-table-column  label="备注">
						<template slot-scope="scope"><span>{{ scope.row.dealOpinions }}</span></template>
					</el-table-column>
				</el-table>
				<el-pagination 
					class="txtCenter pagination"
					background
					@size-change="handleSizeChangeNextProfessionProfileTableData"
					@current-change="handleCurrentChangeNextProfessionProfileTableData"
					:current-page.sync="currentPageNextProfessionProfileTableData"
					:page-sizes="[10,20,30,50]"
					:page-size="100"
					layout=" sizes, prev, pager, next"
					:total="totalNextProfessionProfileTableData">
				</el-pagination>
			</el-dialog>

			<!--专业项目文件-->
			<el-dialog title="专业项目文件" :visible.sync="profileTreeDialogVisible" width="30%">
				<form action='saveFile' enctype='multipart/form-data' method='post' id="fileUpload1">
					<el-upload class="upload-demo" action="saveFile" id="filename1" name='file' ref="upload" :auto-upload='false'
								   :on-change='fileChange1' accept="">
							<a href="#" class="btn-line">
								<!-- <svg class="icon" aria-hidden="true">
									<use xlink:href="#icon-upload"></use>
								</svg> -->
								<span>上传文件</span>
							</a>
						</el-upload>
				</form>
				<!-- <div  role="tablist" v-for="profile, key in fileList" :key="key">
					<el-link type="primary" @click="downloadFile(profile.url, profile.name)" style="color: #00a0e8">{{profile.name}}</el-link>
				</div> -->
				<el-scrollbar style="height: 358px">
					<file-tree :project-id="currentProjectSummaryId"></file-tree>
				</el-scrollbar>
			</el-dialog>

			<!-- 添加上序文件Modal -->
			<el-dialog title="添加我需要的上序文件" :visible.sync="addPreviousProfileDialogVisible" width="30%">
				<el-form size="small" label-suffix="：" label-width="100px">
					<el-form-item label="上序分项目">
						<el-select v-model="selectDepartments" multiple placeholder="请选择">
							<el-option
									v-for="department in departments"
									:key="department.id"
									:label="department.departmentName"
									:value="department.id">
							</el-option>
						</el-select>
					</el-form-item>
					<el-form-item label="内容">
						<el-input v-model="content" placeholder="请输入内容"></el-input>
					</el-form-item>
				</el-form>
				<div slot="footer" class="txtCenter">
					<el-button type="primary" size="small" @click="saveAddPreviousProfileDialog">保存</el-button>
					<el-button size="small" @click="addPreviousProfileDialogVisible = false">保存</el-button>
				</div>
			</el-dialog>

			<!-- 添加下序文件Modal -->
			<el-dialog title="添加下序文件" :visible.sync="addNextProfessionProfileDialogVisible" width="30%">
				<el-form label-width="100px" label-suffix="：" size="small">
					<el-form-item label="内容">
						<el-input v-model="nextProfessionProfileContent"  placeholder="请输入内容"></el-input>
					</el-form-item>
					<el-form-item label="下序分项目">
						<el-select v-model="selectDepartmentsOfNextProfessionProfile" multiple placeholder="请选择"  style="width: 80%">
							<el-option
									v-for="department in nextProfessionProjects"
									:key="department.id"
									:label="department.departmentName"
									:value="department.id">
							</el-option>
						</el-select>
					</el-form-item>
					<el-form-item label="文件">
						<el-select v-model="selectProfiles" multiple placeholder="请选择"  style="width: 80%">
							<el-option
									v-for="profile in profileTrees"
									:key="profile.id"
									:label="profile.name"
									:value="profile.id">
							</el-option>
						</el-select>
					</el-form-item>
				</el-form>
				<div slot="footer" class="txtCenter">
					<el-button type="primary" size="small" @click="saveAddNextProfessionProfileDialog">保存</el-button>
					<el-button size="small" @click="addNextProfessionProfileDialogVisible = false">保存</el-button>
				</div>

				<!-- <div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">内容：</label>
					<input type="text" class="form-control" style="width: 80%; display: inline" placeholder=""  v-model="nextProfessionProfileContent">
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">下序分项目：</label>
					<el-select v-model="selectDepartmentsOfNextProfessionProfile" multiple placeholder="请选择"  style="width: 80%">
						<el-option
								v-for="department in nextProfessionProjects"
								:key="department.id"
								:label="department.departmentName"
								:value="department.id">
						</el-option>
					</el-select>
				</div>
				<div class="form-group">
					<label style="margin-left: 10px; display: inline; width: 20%;">文件：</label>
					<el-select v-model="selectProfiles" multiple placeholder="请选择"  style="width: 80%">
						<el-option
								v-for="profile in profileTrees"
								:key="profile.id"
								:label="profile.name"
								:value="profile.id">
						</el-option>
					</el-select>
				</div>
				<div class="modal-footer">
					<button  class="btn btn-primary" @click="saveAddNextProfessionProfileDialog">保存</button>
				</div> -->
			</el-dialog>

			<!-- 送审流程 -->
			<el-dialog title="送审流程" :visible.sync="reviewProcessDialogVisible" width="50%">
				<el-form ref="form" :model="form" label-width="110px" label-suffix="：">
					<el-form-item label="设计意见" v-if="!designerOpinionDisable">
						<el-input type="textarea" v-model="reviewProcessData.designerOpinion" :disabled="designerOpinionDisable"></el-input>
					</el-form-item>
					<el-form-item label="复核意见" v-if="!reviewerOpioionDisable">
						<el-input type="textarea" v-model="reviewProcessData.reviewerOpioion" :disabled="reviewerOpioionDisable"></el-input>
					</el-form-item>
					<el-form-item label="审核意见" v-if="!inspectorOpionionDisable">
						<el-input type="textarea" v-model="reviewProcessData.inspectorOpionion" :disabled="inspectorOpionionDisable"></el-input>
					</el-form-item>
					<el-form-item label="审定意见" v-if="!validationerOpioionDisable">
						<el-input type="textarea" v-model="reviewProcessData.validationerOpioion" :disabled="validationerOpioionDisable"></el-input>
					</el-form-item>
				</el-form>
				<el-form action='saveReviewProcessFile' enctype='multipart/form-data' method='post' id="reviewProcessFileUpload" label-width="110px">
					<el-form-item>
						<el-upload class="upload-demo" action="saveReviewProcessFile" id="filename1" name='file' ref="upload" :auto-upload='false'
									:on-change='reviewProcessFileChange' accept="">
							<el-button size="small" type="primary" :disabled="designerOpinionDisable">点击上传</el-button>
						</el-upload>
					</el-form-item>
				</el-form>
				<div  role="tablist" v-for="profile, key in reviewProcessFileNames" :key="key">
					<el-link type="primary" @click="downloadReviewProcessFile(profile.url, profile.name)" style="color: #00a0e8">{{profile.name}}</el-link>
				</div>
				<div class="modal-footer" slot="footer">
					<el-button type="primary" size="small" @click="saveReviewProcessData">送审</el-button>
					<el-button type="primary" size="small" @click="saveReviewProcessData">驳回</el-button>
					<!-- <el-button size="small" @click="reviewProcessDialogVisible = false">取消</el-button> -->
				</div>
			</el-dialog>

			<!-- 添加项目Modal -->
			<el-dialog
				title="添加项目"
				:visible.sync="dialogAddProjectVisible"
				width="600px"
			>
				<el-form
					label-width="130px"
					:model="addProject"
					label-suffix="："
					size="small"
				>
					<el-form-item label="项目编号">
						<el-input
							v-model="addProject.projectNum"
							placeholder="请输入项目编号"
							clearable
							style="width: 300px;"
						></el-input>
					</el-form-item>
					<el-form-item label="项目名称">
						<el-input
							v-model="addProject.projectName"
							placeholder="请输入项目名称"
							clearable
							style="width: 300px;"
						></el-input>
					</el-form-item>
					<el-form-item label="设计阶段">
						<el-input
							v-model="addProject.designPhase"
							placeholder="请输入设计阶段"
							clearable
							style="width: 300px;"
						></el-input>
					</el-form-item>
					<el-form-item label="开始时间">
						<el-date-picker
							v-model="addProject.startTime"
							type="date"
							placeholder="选择日期"
							style="width: 300px;"
						></el-date-picker>
					</el-form-item>
					<el-form-item label="截止时间">
						<el-date-picker
							v-model="addProject.stopTime"
							type="date"
							placeholder="截止时间"
							style="width: 300px;"
						></el-date-picker>
					</el-form-item>
					<el-form-item label="项目负责人">
						<el-select
							v-model="principalModalInput"
							filterable
							placeholder="请选择"
							style="width: 300px;"
						>
							<el-option
								v-for="item in principals"
								:key="item.principalId"
								:label="item.principal"
								:value="item.principalId"
							></el-option>
						</el-select>
					</el-form-item>
					<el-form-item label="项目总工">
						<el-select
							v-model="chiefEngineerModalInput"
							filterable
							placeholder="请选择"
							style="width: 300px;"
						>
							<el-option
								v-for="item in chiefEngineers"
								:key="item.chiefEngineerId"
								:label="item.chiefEngineer"
								:value="item.chiefEngineerId"
							></el-option>
						</el-select>
					</el-form-item>
					<el-form-item label="分派部门">
						<el-select
							v-model="selectDepartments"
							multiple
							placeholder="请选择"
							style="width: 300px;"
						>
							<el-option
								v-for="department in departments"
								:key="department.id"
								:label="department.departmentName"
								:value="department.id"
							>
							</el-option>
						</el-select>
					</el-form-item>
				</el-form>
				
				<div slot="footer" class="txtCenter">
					<el-button size="small" type="primary" class="btn btn-primary" @click="saveAddProject">
						保存
					</el-button>
					<el-button size="small" @click="dialogAddProjectVisible = false">取消</el-button>
				</div>
			</el-dialog>

		</div>

		<el-drawer
			title="审批流程"
			:visible.sync="drawer"
			@opened="drawerOpend"
			direction="rtl">
			<div class="progress" style="padding: 10px;">
				<el-radio-group size="small" v-model="activeName">
					<el-radio-button label="first">流程详情</el-radio-button>
					<el-radio-button label="second">流程图</el-radio-button>
				</el-radio-group>

				<el-scrollbar v-show="activeName === 'first'" style="height: calc(100vh - 125px);">
					<el-timeline style="margin-top: 30px;margin-left: 20px; height: 100%;" :reverse="false">
						<el-timeline-item
							v-for="(activity, index) in activities"
							:key="index"
							:timestamp="activity.timestamp" hide-timestamp
							:color="activity.reviewPassedFlag === false ? '#E6A23C' : activity.reviewPassedFlag ? '#67C23A' : '#409eff'"
						>
							<div class="timeline-content">
								<header>
									<div>{{activity.role | approve}}</div> {{activity.timestamp}}
								</header>
								<div v-if="activity.role !== 'start' && activity.role !== 'end'">
									<p>{{activity.person}}进行了审批</p>
									<p>{{activity.label}}意见：{{activity.content}}</p>
								</div>
								<div v-if="!activity.reviewPassedFlag && (activity.role !== 'start' && activity.role !== 'end')">
									<el-button size="mini" @click="handleProcessClick(activity.role, activity.id)">审核</el-button>
								</div>
							</div>
						</el-timeline-item>
					</el-timeline>
				</el-scrollbar>

				<div id="chart" style="width: 100%; height: calc(100vh - 125px);">
					<svg id="svg-canvas" width="400" height="100%"></svg>
				</div>


				<el-tabs v-if="false" v-model="activeName" type="card" @tab-click="handleTabClick">
					<el-tab-pane label="流程详情" name="first">
						<el-timeline style="margin-left: 20px;" :reverse="false">
							<el-timeline-item
								v-for="(activity, index) in activities"
								:key="index"
								:timestamp="activity.timestamp" hide-timestamp
								:color="activity.reviewPassedFlag === false ? '#E6A23C' : activity.reviewPassedFlag ? '#67C23A' : '#409eff'"
							>
								<div class="timeline-content">
									<header>
										<div>{{activity.role | approve}}</div> {{activity.timestamp}}
									</header>
									<div v-if="activity.role !== 'start' && activity.role !== 'end'">
										<p>{{activity.person}}进行了审批</p>
										<p>{{activity.label}}意见：{{activity.content}}</p>
									</div>
									<div v-if="!activity.reviewPassedFlag && (activity.role !== 'start' && activity.role !== 'end')">
										<el-button size="mini" @click="handleProcessClick(activity.role, activity.id)">审核</el-button>
									</div>
								</div>
							</el-timeline-item>
						</el-timeline>
					</el-tab-pane>
					<el-tab-pane label="流程图" name="second">
						<div id="chart" style="width: 100%;">
							<svg id="svg-canvas" width="400" height="600"></svg>
						</div>
					</el-tab-pane>
				</el-tabs>
			</div>
		</el-drawer>
	</div>

	<div layout:fragment="jscontent">
		<!-- <script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js" th:src="@{/webjars/jquery/3.3.1/jquery.js}"></script> -->
		<!-- <script type="text/javascript" src="asserts/js/popper.min.js" th:src="@{/webjars/popper.js/1.11.1/dist/popper.js}"></script> -->
		<!-- <script type="text/javascript" src="asserts/js/bootstrap.min.js" th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script> -->

		<script type="text/javascript" src="asserts/js/feather.min.js" th:src="@{/asserts/js/feather.min.js}"></script>
		<!-- <script type="text/javascript" src="asserts/js/vue.js" th:src="@{/asserts/js/vue.js}"></script> -->
		<!-- <script type="text/javascript" src="asserts/js/iconfont.js" th:src="@{/asserts/js/iconfont.js}"></script> -->
		<!-- <script type="text/javascript" src="asserts/js/const.js" th:src="@{/asserts/js/const.js}"></script> -->
		<!-- <script type="text/javascript" src="asserts/element2.10.1/index.js" th:src="@{/asserts/element2.10.1/index.js}"></script> -->

		<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/d3/5.16.0/d3.min.js" th:src="@{https://cdn.bootcdn.net/ajax/libs/d3/5.16.0/d3.min.js}"></script>
		<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/dagre-d3/0.6.4/dagre-d3.min.js" th:src="@{https://cdn.bootcdn.net/ajax/libs/dagre-d3/0.6.4/dagre-d3.min.js}"></script>

		<script>
			feather.replace()
		</script>

		<script th:src="@{/asserts/js/components/fileTree.js}"></script>

		<script th:inline="javascript" type="text/javascript">

			const cityOptions = ['上海', '北京', '广州', '深圳'];

			appheader.activeIndex2 = 4

			var app = new Vue({
				el: '#app',
				data: {
					addTaskAssignmentDialogVisible: false,
					userProjectsDialogVisible: false,
					previousProfileDialogVisible: false,
					nextProfessionProfileDialogVisible: false,
					profileTreeDialogVisible: false,
					addPreviousProfileDialogVisible: false,
					addNextProfessionProfileDialogVisible: false,
					reviewProcessDialogVisible: false,
					detailTableHidden: false,
					flowChartTableHidden: true,
					designerOpinionDisable: true,
					reviewerOpioionDisable: true,
					inspectorOpionionDisable: true,
					validationerOpioionDisable: true,
					isCollapse: true,
					currentPageTaskAssignmentListData: 1,
					totalTaskAssignmentListData: 0,
					pageSizeTaskAssignmentListData: 10,
					currentPageUserProjectsTableData: 1,
					totalUserProjectsTableData: 0,
					pageSizeUserProjectsTableData: 10,
					currentPagepreviousProfileTableData: 1,
					totalpreviousProfileTableData: 0,
					pageSizepreviousProfileTableData: 10,
					currentPageNextProfessionProfileTableData: 1,
					totalNextProfessionProfileTableData: 0,
					pageSizeNextProfessionProfileTableData: 10,
					currentPage: 1,
					total: 0,
					previousProfileTabId: 0,
					nextProfessionProfileTabId: 0,
					taskAssignmentId: null,
					projectSummaryId: null,
					currentDepartmentId: null,
					departmentId: null,
					projectId: null,
					selectTaskId: null,
					selectUserRole: null,
					project: {},
					projects:{},
					addTaskAssignment:{},
					departments: {},
					reviewProcessData: {},
					nextProfessionProjects: {},
					isActive: true,
					projectClass1: "m-a cur",
					taskAssignmentListData: null,
					userProjectsTableData: null,
					previousProfileTableData: null,
					nextProfessionProfileTableData: null,
					addNextProfessionProfile: null,
					addPreviousProfileHidden: true,
					addNextProfessionProfileHidden: false,
					selectDepartments: null,
					selectDepartmentsOfNextProfessionProfile: null,
					selectProfiles: null,
					content: null,
					nextProfessionProfileContent: null,
					fileType: 'text/plain',
					profileTrees: null,
					form: {
						category: ''
					},
					navigationBars:[
						{
							id: 1,
							name: "信息列表",
							style:"nav-item nav-link active"
						}/* ,
						{
							id: 2,
							name: "流程图",
							style:"nav-item nav-link"
						} */
					],
					previousProfileTabs: [
						{
							id: 0,
							name: "收文",
							style: "nav-item nav-link active",
						},
						{
							id: 1,
							name: "发文",
							style: "nav-item nav-link",
						}
					],
					nextProfessionProfileTabs: [
						{
							id: 0,
							name: "我发起的",
							style: "nav-item nav-link active",
						},
						{
							id: 1,
							name: "被需要的",
							style: "nav-item nav-link",
						}
					],
					fileList: [],
					reviewProcessFileNames: [],
					checkAll: false,
					checkedCities: ['上海', '北京'],
					cities: cityOptions,
					isIndeterminate: true,
					activeName: '收文',

					profileType: 0,

					principals: [],
					chiefEngineers: [],
					departments: [],
					dialogAddProjectVisible: false,
					principalModalInput: null,
          chiefEngineerModalInput: null,
					selectDepartments: null,
					addProject: {},

					drawer: false,
					activeName: 'first',

					activities: [],
					activeProcessId: null,

					/* activities: [
						{
							label: '开始节点',
							content: '活动按期开始',
							timestamp: '2018-04-10'
						}, 
						{
							label: '设计',
							person: '',
							content: '通过审核',
							timestamp: '2018-04-11',
							event: true
						}, 
						{
							label: '复核',
							person: '',
							content: '创建成功',
							timestamp: '2018-04-12',
							event: true
						}, 
						{
							label: '审核',
							person: '',
							content: '创建成功',
							timestamp: '2018-04-13',
							event: true
						}, 
						{
							label: '审定',
							person: '',
							content: '创建成功',
							timestamp: '2018-04-14',
							event: true
						}, 
						{
							label: '结束节点',
							content: '创建成功',
							timestamp: '2018-04-15'
						}
					] */

					dataset: {
						nodes: [
							{id: 0,label: "开始",shape: "rect"},
							{id: 1,label: "设计",shape: "diamond"},
							{id: 2,label: "复核",shape: "diamond"},
							{id: 3,label: "审核",shape: "diamond"},
							{id: 4,label: "审定",shape: "diamond"},
							{id: 5,label: "结束",shape: "rect"}
						],
						edges: [
							{source: 0,target: 1,label: ""},
							
							{source: 4,target: 1,label: "驳回"},
							{source: 3,target: 1,label: "驳回"},
							{source: 2,target: 1,label: "驳回"},
							{source: 1,target: 2,label: ""},

							{source: 2,target: 3,label: ""},
							{source: 3,target: 4,label: ""},
							{source: 4,target: 5,label: ""},
						]
					},

					selectMenuIndex: '0-0',
					defaultOpeneds: [0]
				},
				mounted () {
					this.findAllProjectSummary()
				},
				methods: {
					findAllProjectSummary,
					handleSizeChangeTaskAssignmentListData(val) {
						console.log(`每页 ${val} 条`);
						app.pageSizeTaskAssignmentListData = val
						findByProjectId()
					},
					handleCurrentChangeTaskAssignmentListData(val) {
						console.log(`当前页: ${val}`);
						app.currentPageTaskAssignmentListData = val
						findByProjectId()
					},
					handleSizeChangeUserProjectsTableData(val) {
						console.log(`每页 ${val} 条`);
						app.pageSizeUserProjectsTableData = val
						findUserProjectsByDeptIdAndRole()
					},
					handleCurrentChangeUserProjectsTableData(val) {
						console.log(`当前页: ${val}`);
						app.currentPageUserProjectsTableData = val
						findUserProjectsByDeptIdAndRole()
					},
					handleSizeChangepreviousProfileTableData(val) {
						console.log(`每页 ${val} 条`);
						app.pageSizepreviousProfileTableData = val
						findPreviousProfile()
					},
					handleCurrentChangepreviousProfileTableData(val) {
						console.log(`当前页: ${val}`);
						app.currentPagepreviousProfileTableData = val
						findPreviousProfile()
					},
					handleSizeChangeNextProfessionProfileTableData(val) {
						console.log(`每页 ${val} 条`);
						app.pageSizeNextProfessionProfileTableData = val
						findNextProfessionProfile()
					},
					handleCurrentChangeNextProfessionProfileTableData(val) {
						console.log(`当前页: ${val}`);
						app.currentPageNextProfessionProfileTableData = val
						findNextProfessionProfile()
					},
					handleSizeChange(val) {
						console.log(`每页 ${val} 条`);
					},
					handleCurrentChange(val) {
						console.log(`当前页: ${val}`);
					},
					showProjectById: function(item){
						// console.log("应该显示 " + id)
						app.currentProjectSummaryId = item.projectSummaryId
						var ajaxData = {}
						ajaxData.projectId = item.id
						//更改li颜色
						/* var myProjects = app.projects
						for(var i = 0; i < myProjects.length; i++){
							if(myProjects[i].id == id){
								myProjects[i].deltag = 'm-a cur'
								app.projectId = myProjects[i].id
								app.departmentId = myProjects[i].departmentId
								findByProjectId();//根据分项目查询该分项目下的任务分配情况
							}else{
								myProjects[i].deltag = ''
							}
						}
						app.projects = myProjects
						app.fileList = [] */

						findProjectSummaryById()

						app.projectId = item.id
						findByProjectId();//根据分项目查询该分项目下的任务分配情况
					},
					switchNavigationBar: function (id) {
						var navigationBars = app.navigationBars
						for(var i = 0; i < navigationBars.length; i++){
							if(id == navigationBars[i].id){
								navigationBars[i].style = "nav-item nav-link active"
							}else{
								navigationBars[i].style = "nav-item nav-link"
							}
						}
						if(id == 1){
							app.detailTableHidden = false
							app.flowChartTableHidden = true
						}else if(id == 2){
							app.detailTableHidden = true
							app.flowChartTableHidden = false
						}

					},
					//添加任务按钮
					addTaskAssignmentClick: function () {
						app.addTaskAssignmentDialogVisible = true
					},
					//保存新添加的任务
					saveAddTaskAssignment: function () {
						var that = this
						var addTaskAssignment = app.addTaskAssignment
						addTaskAssignment.projectId = app.projectId
						var ajaxData = {}

						ajaxData.taskAssignment = encodeURI(JSON.stringify(addTaskAssignment))
						$.ajax({
							data: ajaxData,
							type: "GET",
							url: "/crud/taskAssignment/addTaskAssignment",
							traditional: true,
							success: function (result) {
								if(result.code == 200){
									findByProjectId();//根据分项目查询该分项目下的任务分配情况
									app.addTaskAssignmentDialogVisible = false
									app.addTaskAssignment = {}
									that.$message({
										message: '任务添加成功',
										type: 'success'
									});
								}else{
									console.log("返回值失败 addTaskAssignment")
								}

							}
						})
					},
					//编辑设计人员
					editDesignerClick: function (row) {
						app.currentDepartmentId = row.departmentId
						app.selectTaskId = row.id
						app.selectUserRole = "designer"
						app.userProjectsDialogVisible = true
						findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
					},
					//编辑复核人员
					editReviewerClick: function (row) {
						app.currentDepartmentId = row.departmentId
						app.selectTaskId = row.id
						app.selectUserRole = "reviewer"
						app.userProjectsDialogVisible = true
						findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
					},
					//编辑审核人员
					editInspectorClick: function (row) {
						app.currentDepartmentId = row.departmentId
						app.selectTaskId = row.id
						app.selectUserRole = "inspector"
						app.userProjectsDialogVisible = true
						findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
					},
					//编辑审定人员
					editValidationerClick: function (row) {
						app.currentDepartmentId = row.departmentId
						app.selectTaskId = row
						app.selectUserRole = "validationer"
						app.userProjectsDialogVisible = true
						findUserProjectsByDeptIdAndRole();//根据部门id查找人员项目信息
					},
					//保存选中的人员
					saveUser: function(username){
						var ajaxData = {}
						ajaxData.departmentId = app.currentDepartmentId
						ajaxData.selectTaskId = app.selectTaskId
						ajaxData.selectUserRole = app.selectUserRole
						ajaxData.username = encodeURI(JSON.stringify(username))

						console.log(ajaxData)

						editEngineer(ajaxData, this);//编辑分任务的设计、复核、审核、审定人员
					},
					//显示上序资料dialog
					showPreviousProfileDialog: function(){
						app.previousProfileDialogVisible = true
						findPreviousProfile(app.previousProfileTabId);//查找上序资料列表
					},
					//根据tab切换上序文件（我收到的、我申请的）
					getPreviousProfileByTabId: function (tabId) {
						app.previousProfileTabId = tabId
						var previousProfileTabs = app.previousProfileTabs
						for(var i = 0; i < previousProfileTabs.length; i++){
							if(i == tabId){
								previousProfileTabs[i].style = 'nav-item nav-link active'
							}else{
								previousProfileTabs[i].style = 'nav-item nav-link'
							}
						}
						app.previousProfileTabs = previousProfileTabs
						findPreviousProfile(tabId);//查找上序资料列表
						if(tabId == 1){
							app.addPreviousProfileHidden = false
						}else{
							app.addPreviousProfileHidden = true
						}
					},
					//显示下序资料dialog
					showNextProfessionProfileDialog: function(){
						app.nextProfessionProfileDialogVisible = true
						findNextProfessionProfile(app.nextProfessionProfileTabId);//查找下序资料
					},
					//根据tab切换下序资料（我发起的、需要我发送的）
					getNextProfessionProfileByTabId: function(tabId){
						app.nextProfessionProfileTabId = tabId
						var nextProfessionProfileTabs = app.nextProfessionProfileTabs
						for(var i = 0; i < nextProfessionProfileTabs.length; i++){
							if(i == tabId){
								nextProfessionProfileTabs[i].style = 'nav-item nav-link active'
							}else{
								nextProfessionProfileTabs[i].style = 'nav-item nav-link'
							}
						}
						app.nextProfessionProfileTabs = nextProfessionProfileTabs
						findNextProfessionProfile(tabId);//查找上序资料列表
						if(tabId == 1){
							app.addNextProfessionProfileHidden = true
						}else{
							app.addNextProfessionProfileHidden = false
						}
					},
					//显示文件树对话框
					openProfileTreeDialog: function(){
						app.fileList = []
						app.profileTreeDialogVisible = true
						findFilesByProjectId();//查找文件树内容
					},
					uploadDocs: function (params) {
						//TODO OSS文件上传可以在前端直接配置
						console.log(params.file.name)
					},
					beforeUploadDoc: function (file) {
						console.log("beforeUploadDoc function")
						console.log(file)
					},
					handleChange(file, fileList) {
						console.log(file)
						console.log(fileList)
						// this.fileList = fileList.slice(-3);
						this.fileList = fileList;
					},
					//接收上序文件
					acceptPreviousProfile: function (professionProfile) {
						professionProfile.dealFlag = 0;//接收
						professionProfile.dealOpinions = "接收";
						var ajaxData = {}
						ajaxData.professionProfile = encodeURI(JSON.stringify(professionProfile))
						console.log(professionProfile)
						updateProfessionProfile(ajaxData);//更新专业文件数据
						this.$message({
							message: '接收成功',
							type: 'success'
						});
					},
					//退回上序文件
					refusePreviousProfile: function (professionProfile) {
						this.$prompt('请输入驳回意见', '提示', {
							confirmButtonText: '确定',
							cancelButtonText: '取消',
						}).then(({ value }) => {
							professionProfile.dealFlag = 1;//驳回
							professionProfile.dealOpinions = value;
							var ajaxData = {}
							ajaxData.professionProfile = encodeURI(JSON.stringify(professionProfile))
							updateProfessionProfile(ajaxData);//更新专业文件数据
							this.$message({
								message: '驳回成功',
								type: 'success'
							});
						}).catch(() => {
							this.$message({
								type: 'info',
								message: '取消输入'
							});
						});
					},
					//添加我需要的上序文件
					addPreviousProfileClick:function () {
						var projects = app.projects
						var departments = new Array()
						for(var i = 0; i< projects.length; i++){
							if(projects[i].id != app.projectId){
								var department = {};
								department.id = projects[i].id
								department.departmentName = projects[i].departmentName
								departments.push(department)
							}
						}
						app.departments = departments
						console.log(app.departments)
						app.addPreviousProfileDialogVisible = true;
					},
					//保存我添加的需要别人提供给我的上序文件
					saveAddPreviousProfileDialog: function () {
						var ajaxData = {}
						ajaxData.content = app.content
						ajaxData.selectProjectIds = app.selectDepartments
						ajaxData.projectId = app.projectId
						addPreviousProfessionProfile(ajaxData);//添加我需要别人提供给我的上序资料
						app.departments = null
						app.content = null
					},
					//添加我发布的下序资料
					addNextProfessionProfileClick:function () {
						var projects = app.projects
						var departments = new Array()
						for(var i = 0; i< projects.length; i++){
							if(projects[i].id != app.projectId){
								var department = {};
								department.id = projects[i].id
								department.departmentName = projects[i].departmentName
								departments.push(department)
							}
						}
						app.nextProfessionProjects = departments
						app.addNextProfessionProfileDialogVisible = true;
						findFilesByProjectIdAddToNextProfessionProfileList();//查找文件树内容，用于给下序文件list
					},
					//保存我发布的下序资料
					saveAddNextProfessionProfileDialog:function () {
						var ajaxData = {}
						ajaxData.content = app.nextProfessionProfileContent
						ajaxData.selectProjectIds = app.selectDepartmentsOfNextProfessionProfile
						ajaxData.selectProfiles = app.selectProfiles
						ajaxData.projectId = app.projectId
						addNextProfessionProfile(ajaxData);//添加我发给别人的下序资料
						app.nextProfessionProfileContent = null
						app.selectDepartmentsOfNextProfessionProfile = null
						app.selectProfiles = null
					},
					//设计人员点击事件
					designerReviewProcessClick:function (taskAssignmentId) {
						app.taskAssignmentId = taskAssignmentId
						findReviewProcessByTaskAssignmentId();//查询审核流程数据
						app.reviewProcessDialogVisible = true
						app.designerOpinionDisable = false
						setDisable("designerOpinionDisable")
					},
					//复核人员点击事件
					reviewerReviewProcessClick:function (taskAssignmentId) {
						app.taskAssignmentId = taskAssignmentId
						findReviewProcessByTaskAssignmentId();//查询审核流程数据
						app.reviewProcessDialogVisible = true
						setDisable("reviewerOpioionDisable")
					},
					//审核人员点击事件
					inspectorReviewProcessClick:function (taskAssignmentId) {
						app.taskAssignmentId = taskAssignmentId
						findReviewProcessByTaskAssignmentId();//查询审核流程数据
						app.reviewProcessDialogVisible = true
						setDisable("inspectorOpionionDisable")
					},
					//审定人员点击事件
					validationerReviewProcessClick:function (taskAssignmentId) {
						app.taskAssignmentId = taskAssignmentId
						findReviewProcessByTaskAssignmentId();//查询审核流程数据
						app.reviewProcessDialogVisible = true
						setDisable("validationerOpioionDisable")
					},
					//保存送审流程内容
					saveReviewProcessData: function(){
						// saveReviewProcessDataFunction();
						//保存送审内容
						var ajaxData = {}
						// ajaxData.reviewProcessData =  encodeURI(JSON.stringify(app.reviewProcessData))
						// ajaxData.taskAssignmentId = app.taskAssignmentId
						ajax.projectSummary = encodeURI(JSON.stringify(app.reviewProcessData))
						$.ajax({
							data: ajaxData,
							type: "POST",
							url: "/crud/taskReviewProcess/update",
							traditional: true,
							success: function (result) {
								if(result.code == 200){
									app.reviewProcessDialogVisible = false
									app.reviewProcessData = {}
									app.reviewProcessFileNames = []
									findByProjectId();//根据分项目查询该分项目下的任务分配情况
								}else{
									console.log("saveReviewProcessDataFunction 返回值失败")
								}

							}
						})
					},
					fileChange1: function(target){
						var form = document.getElementById("fileUpload1");
						var url = "/crud/profile/uploadFile?projectId=" + app.projectId
						var postData = new FormData(form);
						app.uploading = true;
						$("#msg").html("处理中...");
						$.ajax({
							url: url,
							type: "POST",
							data: postData,
							contentType: false,
							processData: false,
							success: function (result) {
								if (result.code == 200) {
									findFilesByProjectId()
								}else{
								}
							},
							error: function () {
								alert("处理失败！");
							}
						});
					},
					downloadFile: function(ossFileUrl, name){
						downloadFunction(ossFileUrl, name)
					},
					//下载送审流程文件
					downloadReviewProcessFile: function(ossFileUrl, name){
						downloadFunction(ossFileUrl, name)
					},
					//送审流程文件上传
					reviewProcessFileChange: function () {
						var form = document.getElementById("reviewProcessFileUpload");
						var url = "/crud/reviewProcess/uploadFile?taskAssignmentId=" + app.taskAssignmentId
						var postData = new FormData(form);
						app.uploading = true;
						$("#msg").html("处理中...");
						$.ajax({
							url: url,
							type: "POST",
							data: postData,
							contentType: false,
							processData: false,
							success: function (result) {
								if (result.code == 200) {
									findReviewProcessByTaskAssignmentId()
								}else{
								}
							},
							error: function () {
								alert("处理失败！");
							}
						});
					},
					profileChange (id) {
						this.getPreviousProfileByTabId(id)
					},
					nextProfessionProfileChange (id) {
						this.getNextProfessionProfileByTabId(id)
					},
					addProjectClick,
					saveAddProject: function () {
						addProject(this) //通过Modal框添加新的项目
					},

					handleTabClick,

					initGraph,

					showFlowChart,
					getFlowChartData,

					// 删除任务
					deleteTask,

					handleProcessClick,

					// 菜单选中事件
					onMenuSelect,
					onOpen
				}
			})

			// var projectList =[[ ${projectList}]]
			// var departmentId =[[ ${departmentId}]]
			// console.log(projectList)
			// console.log(departmentId)

			// app.projects = projectList || []
			// app.projectSummaryId = projectList[0].projectSummaryId
			// app.currentProjectSummaryId = projectList[0].projectSummaryId

			// app.departmentId = departmentId

			/* for(var i = 0; i < projectList.length; i++){
				if(projectList[i].deltag == "m-a cur"){
					app.projectId = projectList[i].id
				}
			} */

			// findByProjectId();//根据分项目查询该分项目下的任务分配情况
			// findProjectSummaryById()//查看项目详细信息

			/**
			 * 根据分项目查询该分项目下的任务分配情况
			 */
			function findByProjectId() {
				var ajaxData = {}
				ajaxData.currentPage = app.currentPageTaskAssignmentListData
				ajaxData.pageSize = app.pageSizeTaskAssignmentListData
				ajaxData.projectId = app.projectId
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/taskAssignment/findByProjectId",
					success: function (result) {
						if(result.code == 200){
							app.taskAssignmentListData=result.data.list
							app.totalTaskAssignmentListData=result.data.totalCount
						}else{
							console.log("updatePrincipal 返回值失败")
						}

					}
				})
			}

			/**
			 * 根据部门id查找人员项目信息
			 */
			function findUserProjectsByDeptIdAndRole(){
				var ajaxData = {}
				ajaxData.departmentId = app.currentDepartmentId
				ajaxData.selectUserRole = app.selectUserRole
				ajaxData.currentPage = app.currentPageUserProjectsTableData
				ajaxData.pageSize = app.pageSizeUserProjectsTableData
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/userProject/findUserProjectsByDeptIdAndRole",
					success: function (result) {
						if(result.code == 200){
							app.userProjectsTableData=result.data.list
							app.totalUserProjectsTableData = result.data.totalCount
							console.log(result.data.totalCount)
							console.log(result.data.list)
						}else{
							console.log("findUserProjectsByDeptIdAndRole 返回值失败")
						}

					}
				})
			}

			/**
			 * 编辑分任务的设计、复核、审核、审定人员
			 * @param ajaxData
			 */
			function editEngineer(ajaxData, that){
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/taskAssignment/editEngineer",
					success: function (result) {
						if(result.code == 200){
							showEditSuccessMessgae(that);//显示设计、复核、审核、审定编辑成功消息
							app.selectTaskId = null
							app.selectUserRole = null
							app.userProjectsDialogVisible = false
							findByProjectId();//根据分项目查询该分项目下的任务分配情况
						}else{
							console.log("editEngineer 返回值失败")
						}

					}
				})
			}

			/**
			 * 显示编辑成功消息
			 * @param that
			 */
			function showEditSuccessMessgae(that){
				if("designer" == app.selectUserRole){
					that.$message({
						message: "设计人员编辑成功",
						type: 'success'
					});
				}else if("reviewer" == app.selectUserRole){
					that.$message({
						message: "复核人员编辑成功",
						type: 'success'
					});
				}else if("inspector" == app.selectUserRole){
					that.$message({
						message: "审核人员编辑成功",
						type: 'success'
					});
				}else if("validationer" == app.selectUserRole){
					that.$message({
						message: "审定人员编辑成功",
						type: 'success'
					});
				}


			}

			/**
			 * 查找上序资料列表
			 * @param projectId
			 * @param flag
			 */
			function findPreviousProfile(flag){
				var ajaxData = {}
				ajaxData.projectId = app.projectId
				var url = "/crud/previousProfile/findMyReceivedPreviousProfile"	//我收到的上序资料
				if(flag == 1){
					url = "/crud/previousProfile/findMyInitiatedPreviousProfile" //我主动需要的上序资料
				}
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: url,
					success: function (result) {
						if(result.code == 200){
							app.previousProfileTableData = result.data.list
							app.totalpreviousProfileTableData=result.data.totalCount
						}else{
							console.log("findPreviousProfile 返回值失败")
						}
					}
				})
			}

			/**
			 * 查找下序资料列表
			 * @param projectId
			 * @param flag
			 */
			function findNextProfessionProfile(flag){
				var ajaxData = {}
				ajaxData.projectId = app.projectId
				var url = "/crud/previousProfile/findMySubmitProfileToNextProfession"	//我发起的下序资料
				if(flag == 1){
					url = "/crud/previousProfile/findMyNeededProfileToNextProfession" //别人向我要的资料
				}
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: url,
					success: function (result) {
						if(result.code == 200){
							app.nextProfessionProfileTableData = result.data.list
							app.totalNextProfessionProfileTableData = result.data.list

						}else{
							console.log("findNextProfessionProfile 返回值失败")
						}

					}
				})
			}


			/**
			 * 查找文件树
			 */
			function findFilesByProjectId(){
				var ajaxData = {}
				ajaxData.projectId = app.projectId
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/profile/findFilesByProjectId",
					success: function (result) {
						if(result.code == 200){
							app.fileList = result.data
						}else{
							console.log("findFilesByProjectId 返回值失败")
						}

					}
				})
			}

			/**
			 * 查找文件树内容，用于给下序文件list
			 */
			function findFilesByProjectIdAddToNextProfessionProfileList(){
				var ajaxData = {}
				ajaxData.projectId = app.projectId
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/profile/findFilesByProjectId",
					success: function (result) {
						if(result.code == 200){
							app.profileTrees = result.data
						}else{
							console.log("findFilesByProjectId 返回值失败")
						}

					}
				})
			}

			/**
			 * 更新专业文件数据，接收、驳回
			 */
			function updateProfessionProfile(ajaxData){
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/previousProfile/update",
					success: function (result) {
						if(result.code == 200){
							findPreviousProfile(app.previousProfileTabId);//查找上序资料列表
						}else{
							console.log("updateProfessionProfile 返回值失败")
						}

					}
				})
			}

			/**
			 *  添加我需要别人提供给我的上序资料
			 */
			function addPreviousProfessionProfile(ajaxData){
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/previousProfile/addPreviousProfessionProfile",
					traditional: true,
					success: function (result) {
						if(result.code == 200){
							app.addPreviousProfileDialogVisible = false
							findPreviousProfile(app.previousProfileTabId);//查找上序资料列表
						}else{
							console.log("addPreviousProfessionProfile 返回值失败")
						}

					}
				})
			}

			/**
			 * 添加我发给别人的下序资料
			 */
			function addNextProfessionProfile(ajaxData){
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/previousProfile/addNextProfessionProfile",
					traditional: true,
					success: function (result) {
						if(result.code == 200){
							app.addNextProfessionProfileDialogVisible = false
							findNextProfessionProfile(app.nextProfessionProfileTabId);//查找下序资料列表
						}else{
							console.log("addNextProfessionProfile 返回值失败")
						}

					}
				})
			}

			/**
			 * 查询审核流程数据
			 */
			function findReviewProcessByTaskAssignmentId(processId){
				app.reviewProcessData = {}
				app.reviewProcessFileNames = []
				var ajaxData = {}
				ajaxData.id = app.activeProcessId || 27 // app.taskAssignmentId
				$.ajax({
					data: ajaxData,
					type: "GET",
					// url: "/crud/reviewProcess/findByTaskAssignmentId",
					url: "/crud/taskReviewProcess/findById",
					traditional: true,
					success: function (result) {
						if(result.code == 200){
							if(result.data != null){
								app.reviewProcessData = result.data
								var reviewProcessFileNames = JSON.parse(result.data.file)
								app.reviewProcessFileNames = reviewProcessFileNames

								/* app.activities[0].content = app.reviewProcessData.designerOpinion
								app.activities[0].timestamp = app.reviewProcessData.designerCreateTime

								app.activities[1].content = app.reviewProcessData.reviewerOpioion
								app.activities[1].timestamp = app.reviewProcessData.reviewerCreateTime

								app.activities[2].content = app.reviewProcessData.inspectorOpionion
								app.activities[2].timestamp = app.reviewProcessData.inspectorCreateTime

								app.activities[3].content = app.reviewProcessData.validationerOpioion
								app.activities[3].timestamp = app.reviewProcessData.validationerCreateTime */


							}


						}else{
							console.log("findReviewProcessByTaskAssignmentId 返回值失败")
						}

					}
				})
			}

			/**
			 * 保存送审流程内容
			 */
			function saveReviewProcessDataFunction(){
				var ajaxData = {}
				ajaxData.reviewProcessData =  encodeURI(JSON.stringify(app.reviewProcessData))
				ajaxData.taskAssignmentId = app.taskAssignmentId
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/reviewProcess/saveReviewProcessData",
					traditional: true,
					success: function (result) {
						if(result.code == 200){
							app.reviewProcessDialogVisible = false
							app.reviewProcessData = {}
							app.reviewProcessFileNames = []
							findByProjectId();//根据分项目查询该分项目下的任务分配情况
						}else{
							console.log("saveReviewProcessDataFunction 返回值失败")
						}

					}
				})
			}

			/**
			 * 设置可见与不可见
			 */
			function setDisable(disabledElement){
				if(disabledElement == "designerOpinionDisable"){
					app.designerOpinionDisable = false
					app.reviewerOpioionDisable = true
					app.inspectorOpionionDisable = true
					app.validationerOpioionDisable = true
				}else if(disabledElement == "reviewerOpioionDisable"){
					app.designerOpinionDisable = true
					app.reviewerOpioionDisable = false
					app.inspectorOpionionDisable = true
					app.validationerOpioionDisable = true
				}else if(disabledElement == "inspectorOpionionDisable"){
					app.designerOpinionDisable = true
					app.reviewerOpioionDisable = true
					app.inspectorOpionionDisable = false
					app.validationerOpioionDisable = true
				}else if(disabledElement == "validationerOpioionDisable"){
					app.designerOpinionDisable = true
					app.reviewerOpioionDisable = true
					app.inspectorOpionionDisable = true
					app.validationerOpioionDisable = false
				}


			}


			/**
			 * 查找所有项目，将项目名字赋值给li，然后将class赋予一个变量
			 */
			function findAllProjectSummary(){
				var ajaxData = {}
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/projectSummary/findAll",
					success: function (result) {
						if(result.code == 200){
							var projectsSummaryLiShow = result.data
							/* for(var i = 0; i < projectsSummaryLiShow.length; i++){
								if(i == 0){
									app.currentProjectSummaryId = projectsSummaryLiShow[i].children[0].id
									projectsSummaryLiShow[i].deltag = 'm-a cur'
								}else{
									projectsSummaryLiShow[i].deltag = ''
								}
							} */
							app.projects=projectsSummaryLiShow
							app.currentProjectSummaryId = projectsSummaryLiShow[0].id
							let departmentId = projectsSummaryLiShow[0].children[0].id
							app.showProjectById(projectsSummaryLiShow[0].children[0])

							// findProjectSummaryById();//按照总项目id查找总项目详细信息
							// findProjectsByProjectSummaryId();//按照总项目id查找分项目详细信息

						}else{
							console.log("返回值失败")
						}

					}
				})
			}

			/**
			 * 下载
			 */
			function downloadFunction(ossFileUrl, name) {
				var url = '/crud/previousProfile/dwnSavedFile?fileName=' + encodeURI(ossFileUrl);
				var xhr = new XMLHttpRequest();
				xhr.open('GET', url, true);        // 也可以使用POST方式，根据接口
				// xhr.responseType = "blob";    // 返回类型blob
				xhr.responseType = "text";    // 返回类型blob
				// 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑
				xhr.onload = function () {
					// 请求完成
					if (this.status === 200) {
						// var blob = this.response;
						let res = xhr.responseText;
						// let blob = new Blob([res], {type: 'text/xml'});
						let blob = new Blob([res], {type: 'text'});
						var reader = new FileReader();
						//TODO 文件下载不能下pdf、dwg文件
						reader.readAsDataURL(blob);    // 转换为base64，可以直接放入a表情href
						reader.onload = function (e) {
							// 转换完成，创建一个a标签用于下载
							var a = document.createElement('a');
							a.download = name;
							a.href = e.target.result;
							$("body").append(a);    // 修复firefox中无法触发click
							a.click();
							$(a).remove();
						}
					}
				};
				// 发送ajax请求
				xhr.send()
			}

			/**
			 * 查询项目信息
			 */
			function findProjectSummaryById(){
				var ajaxData = {}
				ajaxData.id = app.currentProjectSummaryId
				$.ajax({
					data: ajaxData,
					type: "GET",
					url: "/crud/projectSummary/findById",
					success: function (result) {
						if(result.code == 200){
							app.project=result.data
						}else{
							console.log("返回值失败 findProjectSummaryById")
						}

					}
				})
			}

			function addProjectClick () {
				app.dialogAddProjectVisible = true
				findProjectSummaryPrincipals() //查找所有可以担任负责人的人选
				findProjectSummaryChiefEngineers() //查询所有可以当总项目总工的人选
				getDepartments() //查询所有部门信息
			}

			/**
			* 查询所有可以当总项目总负责人的人选
			*/
			function findProjectSummaryPrincipals() {
			var ajaxData = {}
			ajaxData.currentDepartmentId = app.currentDepartmentId
			$.ajax({
				data: ajaxData,
				type: 'GET',
				url: '/crud/user/findProjectSummaryPrincipals',
				success: function (result) {
					if (result.code == 200) {
						var users = result.data
						var principals = []
						for (var i = 0; i < users.length; i++) {
							var principal = {}
							principal.principal = users[i].username
							principal.principalId = users[i].id
							principals[i] = principal
						}
						app.principals = principals
					} else {
						console.log('findProjectSummaryPrincipals 返回值失败')
					}
				},
			})
		}

		/**
			* 查询所有可以当总项目总工的人选
			*/
		function findProjectSummaryChiefEngineers() {
			var ajaxData = {}
			ajaxData.currentDepartmentId = app.currentDepartmentId
			$.ajax({
				data: ajaxData,
				type: 'GET',
				url: '/crud/user/findProjectSummaryChiefEngineers',
				success: function (result) {
					if (result.code == 200) {
						var users = result.data
						var chiefEngineers = []
						for (var i = 0; i < users.length; i++) {
							var chiefEngineer = {}
							chiefEngineer.chiefEngineer = users[i].username
							chiefEngineer.chiefEngineerId = users[i].id
							chiefEngineers[i] = chiefEngineer
						}
						app.chiefEngineers = chiefEngineers
					} else {
						console.log('findAllChiefEngineer 返回值失败')
					}
				},
			})
		}

		/**
			* 查询所有所信息，将值赋给li
			*/
		function getDepartments() {
			$.ajax({
				data: null,
				type: 'GET',
				url: '/crud/department/findAll',
				success: function (result) {
					if (result.code == 200) {
						app.departments = result.data
					} else {
						console.log('getDepartments 返回值失败')
					}
				},
			})
		}

		/**
		* 通过Modal框添加新的项目
		* */
		function addProject(that) {
			var ajaxData = {}
			var addProject = app.addProject
			addProject.principalId = app.principalModalInput
			addProject.chiefEngineerId = app.chiefEngineerModalInput

			var selectDepartments = app.selectDepartments
			console.log(selectDepartments.length)
			console.log(selectDepartments[0])

			if (addProject.projectNum == null || addProject.projectNum == '') {
				that.$message({
					message: '项目编号不能为空',
					type: 'warning',
				})
			} else if (
				addProject.projectName == null ||
				addProject.projectName == ''
			) {
				that.$message({
					message: '项目名称不能为空',
					type: 'warning',
				})
			} else if (
				addProject.designPhase == null ||
				addProject.designPhase == ''
			) {
				that.$message({
					message: '设计阶段不能为空',
					type: 'warning',
				})
			} else if (
				addProject.startTime == null ||
				addProject.startTime == ''
			) {
				that.$message({
					message: '开始时间不能为空',
					type: 'warning',
				})
			} else if (
				addProject.stopTime == null ||
				addProject.stopTime == ''
			) {
				that.$message({
					message: '结束时间不能为空',
					type: 'warning',
				})
			} else if (
				addProject.principalId == null ||
				addProject.principalId == ''
			) {
				that.$message({
					message: '负责人不能为空',
					type: 'warning',
				})
			} else if (
				addProject.chiefEngineerId == null ||
				addProject.chiefEngineerId == ''
			) {
				that.$message({
					message: '总工不能为空',
					type: 'warning',
				})
			} else if (
				app.selectDepartments == null ||
				app.selectDepartments.length == 0
			) {
				that.$message({
					message: '分派部门不能为空',
					type: 'warning',
				})
			} else {
				ajaxData.selectDepartments = app.selectDepartments
				ajaxData.projectSummary = encodeURI(
					JSON.stringify(app.addProject)
				)
				$.ajax({
					data: ajaxData,
					type: 'GET',
					url: 'projectSummary/addProject/',
					traditional: true,
					success: function (result) {
						if (result.code == 200) {
							findAllProjectSummary()
							app.dialogAddProjectVisible = false
							app.addProject = {}
							app.principalModalInput = null
							app.chiefEngineerModalInput = null
							app.principals = {}
							app.chiefEngineers = {}
							app.selectDepartments = null
							app.departments = {}
							that.$message({
								message: '项目添加成功',
								type: 'success',
							})
						} else {
							console.log('返回值失败 addProject')
						}
					},
				})
			}
		}


		function handleTabClick () {}

		function initGraph (dataset) {
			// 创建 graph 对象
			let g = new dagreD3.graphlib.Graph();
			//设置图
			g.setGraph({
				rankdir:'TB',
				align:'UL',
				// align:'DL',
				// nodesep: 80,
				// edgesep:100,
				ranksep: 30,
				marginx:50,
				marginy:50
			});
			dataset.nodes.forEach(item => {
				g.setNode(item.id, {
					//节点标签
					label: item.label,
					//节点形状
					shape: item.shape,
					//节点样式
					style: "fill:#409EFF;stroke:#409EFF",
					labelStyle:'fill: #fff',
					width: 40,
					height: 10
				})
			})
			dataset.edges.forEach(item => {
					g.setEdge(item.source,item.target, {
							//边标签
							label: item.label,
							labelStyle: item.label === '驳回' ? 'fill:#F56C6C' : 'fill:#409EFF',
							//边样式
							style: (item.label === '驳回' ? 'stroke:#F56C6C;' : "stroke:#409EFF;") + 'fill:#fff;stroke-width:1.5px',
							arrowhead: 'vee',
							arrowheadStyle: item.label === '驳回' ? 'fill:#F56C6C' : 'fill:#409EFF'
						})
				})
			// 创建渲染器
			let render = new dagreD3.render();
			// 选择 svg 并添加一个g元素作为绘图容器.
			let svgGroup = d3.select('svg').append('g');
			// 建立拖拽缩放
			let zoom = d3.zoom()
					.on("zoom", function () {
						svgGroup.attr("transform", d3.event.transform);
					});
			d3.select('svg').call(zoom);
			// 在绘图容器上运行渲染器生成流程图.
			render(svgGroup, g);

		}
		
		function drawerOpend () {
			app.initGraph(app.dataset)
		}

		function showFlowChart (id) {
			// app.drawer = true
			app.taskAssignmentId = id
			this.getFlowChartData(id)

			// 获取审批意见
			findReviewProcessByTaskAssignmentId()
		}

		function getFlowChartData (id) {
			const _this = this
			// var postData = new FormData(form);
			$.ajax({
				// url: '/crud/taskAssignment/findById?id=' + id,
				url: '/crud/taskReviewProcess/findByTaskAssignmentId?id=' + id,
				type: "GET",
				// data: postData,
				contentType: false,
				processData: false,
				success: function (result) {
					if (result.code == 200) {
						let temp = result.data
						_this.activities = [{
							role: 'start'
						}].concat(temp)
						console.log(_this.activities)
						app.drawer = true
						/* app.activities = [
						{
							label: '开始节点',
							content: '活动按期开始',
							timestamp: temp.startTime
						}, 
						{
							label: '设计',
							person: temp.designer,
							content: '',
							timestamp: '',
							event: true
						}, 
						{
							label: '复核',
							person: temp.reviewer,
							content: '',
							timestamp: '',
							event: true
						}, 
						{
							label: '审核',
							person: temp.inspector,
							content: '',
							timestamp: '',
							event: true
						}, 
						{
							label: '审定',
							person: temp.validationer,
							content: '',
							timestamp: '',
							event: true
						}, 
						{
							label: '结束节点',
							content: '',
							timestamp: temp.stopTime
						}
					] */

					}else{
					}
				},
				error: function () {
					alert("处理失败！");
				}
			});
		}

		function deleteTask (id) {
			let _this = this 
			let ajaxData = {
				id
			}
			this.$confirm('此操作将永久删除该任务, 是否继续?', '提示', {
				confirmButtonText: '确定',
				cancelButtonText: '取消',
				type: 'warning'
			}).then(() => {
				$.ajax({
					data: ajaxData,
					type: 'POST',
					url: '/crud/taskAssignment/delete',
					success: function (result) {
						if (result.code == 200) {
							_this.$message.success('删除任务成功')
							findByProjectId()
						} else {
							_this.$message.errir('删除项目失败')
						}
					}
				})
			}).catch(() => {
				this.$message({
					type: 'info',
					message: '已取消删除'
				});          
			});
		}

		function handleProcessClick (type, id) {
			this.activeProcessId = id // 当前点击审核的流程id
			switch (type) {
				case 'designer':
					app.designerReviewProcessClick(app.taskAssignmentId)
					break;
				case 'reviewer':
					app.reviewerReviewProcessClick(app.taskAssignmentId)

					break
				case 'inspector':
					app.inspectorReviewProcessClick(app.taskAssignmentId)
					break
				case 'validationer':
					app.validationerReviewProcessClick(app.taskAssignmentId)
					break
			}

		}

		function onMenuSelect (index) {
			this.selectMenuIndex = index
		}
		function onOpen (index) {
			this.defaultOpeneds = [index]
		}

		Vue.filter('approve', function (value) {
			if (!value) return ''
			const roles = {
				start: '开始节点',
				designer: '设计',
				reviewer: '复核',
				inspector: '审核',
				validationer: '审定',
				end: '结束节点'
			}
			return roles[value]
		})
		</script>
	</div>
</div>
</body>
</html>